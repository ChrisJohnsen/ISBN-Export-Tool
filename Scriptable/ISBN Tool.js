/*! production git: v0.7-0-g9745f39 */
function e(e){return!!e&&"object"==typeof e}const t=FileManager.local();function n(e){return t.fileName(e)}function i(e,n,i){const a=function(e){const n=t.fileName(e,!0);if(!e.endsWith(n))throw"path does not end with extracted filename!?";return e.slice(0,e.length-n.length).replace(/[/]*$/,"")}(e),s=t.fileName(e),r=i?.(s)??s;return t.joinPath(a,r+"."+n)}class a{rw;constructor(e){this.rw=new r(e)}data;async read(){await this.rw.exists()?this.data=JSON.parse(await this.rw.readString()):this.data=null}async write(){this.rw.writeString(JSON.stringify(this.data))}}class s{rw;constructor(e){this.rw=new r(e)}log=[];append(e){this.log.push(e)}async flush(){if(this.log.length>0){const e=this.log.splice(0);await this.rw.writeString(await this.rw.readString()+e.join("\n")+"\n")}}}class r{constructor(e){this._pathname=e}get pathname(){return this._pathname}async exists(){return t.fileExists(this._pathname)}async read(){return t.fileExists(this._pathname)?(await t.downloadFileFromiCloud(this._pathname),t.read(this._pathname)):Data.fromString("")}async write(e){t.write(this._pathname,e)}async readString(){return(await this.read()).toRawString()}async writeString(e){return this.write(Data.fromString(e))}async remove(){return t.remove(this._pathname)}}function o(){}function c(){return"undefined"!=typeof WeakMap?new WeakMap:{add:o,delete:o,get:o,set:o,has:function(e){return!1}}}var l=Object.prototype.hasOwnProperty,h=function(e,t){return l.call(e,t)};function d(e,t){for(var n in t)h(t,n)&&(e[n]=t[n]);return e}var u=/^[ \t]*(?:\r\n|\r|\n)/,g=/(?:\r\n|\r|\n)[ \t]*$/,f=/^(?:[\r\n]|$)/,p=/(?:\r\n|\r|\n)([ \t]*)(?:[^ \t\r\n]|$)/,m=/^[ \t]*[\r\n][ \t\r\n]*$/;function w(e,t,n){var i=0,a=e[0].match(p);a&&(i=a[1].length);var s=new RegExp("(\\r\\n|\\r|\\n).{0,"+i+"}","g");t&&(e=e.slice(1));var r=n.newline,o=n.trimLeadingNewline,c=n.trimTrailingNewline,l="string"==typeof r,h=e.length;return e.map((function(e,t){return e=e.replace(s,"$1"),0===t&&o&&(e=e.replace(u,"")),t===h-1&&c&&(e=e.replace(g,"")),l&&(e=e.replace(/\r\n|\n|\r/g,(function(e){return r}))),e}))}var b=function e(t){var n=c(),i=c(),a=d((function a(s){for(var r,o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];if(h(r=s,"raw")&&h(r,"length")){var l=s,u=(o[0]===a||o[0]===b)&&m.test(l[0])&&f.test(l[1]),g=u?i:n,p=g.get(l);if(p||(p=w(l,u,t),g.set(l,p)),0===o.length)return p[0];var y=function(e,t){for(var n="",i=0,a=e.length;i<a;i++)n+=e[i],i<a-1&&(n+=t[i]);return n}(p,u?o.slice(1):o);return y}return e(d(d({},t),s||{}))}),{string:function(e){return w([e],!1,t)[0]}});return a}({trimLeadingNewline:!0,trimTrailingNewline:!0});if("undefined"!=typeof module)try{module.exports=b,Object.defineProperty(b,"__esModule",{value:!0}),b.default=b,b.outdent=b}catch(e){}const y=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function v(e){return null===e?"null":void 0===e?"undefined":""===e?"an empty string":"symbol"==typeof e?`<${e.toString()}>`:Array.isArray(e)?"an array":JSON.stringify(e)}function S(e,t){var n,i,a;return"number"==typeof t?`${null!==(n=null==e?void 0:e.p)&&void 0!==n?n:"."}[${t}]`:y.test(t)?`${null!==(i=null==e?void 0:e.p)&&void 0!==i?i:""}.${t}`:`${null!==(a=null==e?void 0:e.p)&&void 0!==a?a:"."}[${JSON.stringify(t)}]`}function I({errors:e,p:t}={},n){return null==e||e.push(`${null!=t?t:"."}: ${n}`),!1}function R(e,t){return n=>{e[t]=n}}function T(e,t){return n=>{const i=e[t];return e[t]=n,T(e,t).bind(null,i)}}function E(){return _({test:(e,t)=>!0})}function k(){return _({test:(e,t)=>"string"==typeof e||I(t,`Expected a string (got ${v(e)})`)})}function O(){return _({test:(e,t)=>{var n;if("number"!=typeof e){if(void 0!==(null==t?void 0:t.coercions)){if(void 0===(null==t?void 0:t.coercion))return I(t,"Unbound coercion result");let i;if("string"==typeof e){let n;try{n=JSON.parse(e)}catch(e){}if("number"==typeof n){if(JSON.stringify(n)!==e)return I(t,`Received a number that can't be safely represented by the runtime (${e})`);i=n}}if(void 0!==i)return t.coercions.push([null!==(n=t.p)&&void 0!==n?n:".",t.coercion.bind(null,i)]),!0}return I(t,`Expected a number (got ${v(e)})`)}return!0}})}function N(e,{delimiter:t}={}){return _({test:(n,i)=>{var a;const s=n;if("string"==typeof n&&void 0!==t&&void 0!==(null==i?void 0:i.coercions)){if(void 0===(null==i?void 0:i.coercion))return I(i,"Unbound coercion result");n=n.split(t)}if(!Array.isArray(n))return I(i,`Expected an array (got ${v(n)})`);let r=!0;for(let t=0,a=n.length;t<a&&(r=e(n[t],Object.assign(Object.assign({},i),{p:S(i,t),coercion:T(n,t)}))&&r,r||null!=(null==i?void 0:i.errors));++t);return n!==s&&i.coercions.push([null!==(a=i.p)&&void 0!==a?a:".",i.coercion.bind(null,n)]),r}})}function A(e,{delimiter:t}={}){const n=(i=e.length,_({test:(e,t)=>e.length===i||I(t,`Expected to have a length of exactly ${i} elements (got ${e.length})`)}));var i;return _({test:(i,a)=>{var s;if("string"==typeof i&&void 0!==t&&void 0!==(null==a?void 0:a.coercions)){if(void 0===(null==a?void 0:a.coercion))return I(a,"Unbound coercion result");i=i.split(t),a.coercions.push([null!==(s=a.p)&&void 0!==s?s:".",a.coercion.bind(null,i)])}if(!Array.isArray(i))return I(a,`Expected a tuple (got ${v(i)})`);let r=n(i,Object.assign({},a));for(let t=0,n=i.length;t<n&&t<e.length&&(r=e[t](i[t],Object.assign(Object.assign({},a),{p:S(a,t),coercion:T(i,t)}))&&r,r||null!=(null==a?void 0:a.errors));++t);return r}})}function x(e,{keys:t=null}={}){const n=N(A([null!=t?t:k(),e]));return _({test:(i,a)=>{var s;if(Array.isArray(i)&&void 0!==(null==a?void 0:a.coercions))return void 0===(null==a?void 0:a.coercion)?I(a,"Unbound coercion result"):!!n(i,Object.assign(Object.assign({},a),{coercion:void 0}))&&(i=Object.fromEntries(i),a.coercions.push([null!==(s=a.p)&&void 0!==s?s:".",a.coercion.bind(null,i)]),!0);if("object"!=typeof i||null===i)return I(a,`Expected an object (got ${v(i)})`);const r=Object.keys(i);let o=!0;for(let n=0,s=r.length;n<s&&(o||null!=(null==a?void 0:a.errors));++n){const s=r[n],c=i[s];"__proto__"!==s&&"constructor"!==s?(null===t||t(s,a))&&e(c,Object.assign(Object.assign({},a),{p:S(a,s),coercion:T(i,s)}))||(o=!1):o=I(Object.assign(Object.assign({},a),{p:S(a,s)}),"Unsafe property name")}return o}})}function C(e,{extra:t=null}={}){const n=Object.keys(e),i=_({test:(i,a)=>{if("object"!=typeof i||null===i)return I(a,`Expected an object (got ${v(i)})`);const s=new Set([...n,...Object.keys(i)]),r={};let o=!0;for(const n of s){if("constructor"===n||"__proto__"===n)o=I(Object.assign(Object.assign({},a),{p:S(a,n)}),"Unsafe property name");else{const s=Object.prototype.hasOwnProperty.call(e,n)?e[n]:void 0,c=Object.prototype.hasOwnProperty.call(i,n)?i[n]:void 0;void 0!==s?o=s(c,Object.assign(Object.assign({},a),{p:S(a,n),coercion:T(i,n)}))&&o:null===t?o=I(Object.assign(Object.assign({},a),{p:S(a,n)}),`Extraneous property (got ${v(c)})`):Object.defineProperty(r,n,{enumerable:!0,get:()=>c,set:R(i,n)})}if(!o&&null==(null==a?void 0:a.errors))break}return null===t||!o&&null==(null==a?void 0:a.errors)||(o=t(r,a)&&o),o}});return Object.assign(i,{properties:e})}function B(e){return C(e,{extra:x(E())})}function _({test:e}){return(t=e,()=>t)();var t}class D extends Error{constructor({errors:e}={}){let t="Type mismatch";if(e&&e.length>0){t+="\n";for(const n of e)t+=`\n- ${n}`}super(t)}}function M(e,t,{coerce:n=!1,errors:i,throw:a}={}){const s=i?[]:void 0;if(!n){if(t(e,{errors:s}))return a?e:{value:e,errors:void 0};if(a)throw new D({errors:s});return{value:void 0,errors:null==s||s}}const r={value:e},o=[];if(!t(e,{errors:s,coercion:T(r,"value"),coercions:o})){if(a)throw new D({errors:s});return{value:void 0,errors:null==s||s}}for(const[,e]of o)e();return a?r.value:{value:r.value,errors:void 0}}function $(e){return _({test:(t,n)=>void 0===t||e(t,n)})}var L;!function(e){e.Forbids="Forbids",e.Requires="Requires"}(L||(L={})),L.Forbids,L.Requires;var W='async function measureHorizontalBounds(url) {\n  const imageData = await getImageData(url);\n  if (!imageData)\n    return null;\n  const { width, height } = imageData;\n  const h = horizontalBounds(imageData);\n  if (!h)\n    return null;\n  return {\n    size: { width, height },\n    bounds: h\n  };\n}\nasync function measureVerticalBounds(url) {\n  const imageData = await getImageData(url);\n  if (!imageData)\n    return null;\n  const { width, height } = imageData;\n  const v = verticalBounds(imageData);\n  if (!v)\n    return null;\n  return {\n    size: { width, height },\n    bounds: v\n  };\n}\nasync function measureBounds(url) {\n  const imageData = await getImageData(url);\n  if (!imageData)\n    return null;\n  const { width, height } = imageData;\n  const h = horizontalBounds(imageData);\n  if (!h)\n    return null;\n  const v = verticalBounds(imageData);\n  if (!v)\n    return null;\n  return {\n    size: { width, height },\n    bounds: { ...h, ...v }\n  };\n}\nasync function getImageData(url) {\n  const source = document.createElement("img");\n  source.src = url;\n  if (!source.complete)\n    await new Promise((resolve) => {\n      source.addEventListener("load", resolve);\n    });\n  const width = source.naturalWidth;\n  const height = source.naturalHeight;\n  const canvas = document.createElement("canvas");\n  canvas.width = width;\n  canvas.height = height;\n  const c = canvas.getContext("2d", { alpha: true, desynchronized: true });\n  if (!c)\n    return null;\n  c.drawImage(source, 0, 0);\n  return c.getImageData(0, 0, width, height);\n}\nfunction horizontalBounds(imageData) {\n  const left = leftBound(imageData);\n  if (left == null)\n    return null;\n  const right = rightBound(imageData, left) ?? left;\n  return { left, right };\n}\nfunction leftBound(imageData, stopColumn) {\n  const { width, height, data } = imageData;\n  stopColumn ??= width;\n  for (let column = 0; column < width && column < stopColumn; column++)\n    for (let row = 0; row < height; row++)\n      if (data[4 * (row * width + column) + 3] != 0)\n        return column;\n  return null;\n}\nfunction rightBound(imageData, stopColumn) {\n  const { width, height, data } = imageData;\n  stopColumn ??= -1;\n  for (let column = width - 1; column >= 0 && column >= stopColumn + 1; column--)\n    for (let row = height - 1; row >= 0; row--)\n      if (data[4 * (row * width + column) + 3] != 0)\n        return column;\n  return null;\n}\nfunction verticalBounds(imageData) {\n  const top = upperBound(imageData);\n  if (top == null)\n    return null;\n  const bottom = lowerBound(imageData, top) ?? top;\n  return { top, bottom };\n}\nfunction upperBound(imageData, stopRow) {\n  const { width, height, data } = imageData;\n  stopRow ??= height;\n  const firstAlpha = 3;\n  const startOfStopRow = 4 * stopRow * width;\n  for (let p = firstAlpha; p < startOfStopRow; p += 4)\n    if (data[p] != 0)\n      return Math.trunc(p / 4 / width);\n  return null;\n}\nfunction lowerBound(imageData, stopRow) {\n  const { width, height, data } = imageData;\n  stopRow ??= -1;\n  const lastAlpha = 4 * width * height - 1;\n  const endOfStopRow = 4 * (stopRow + 1) * width - 1;\n  for (let p = lastAlpha; p > endOfStopRow; p -= 4)\n    if (data[p] != 0)\n      return Math.trunc(p / 4 / width);\n  return null;\n}\n\nObject.assign(globalThis, { measureHorizontalBounds, measureVerticalBounds, measureBounds });\n';const F=C({width:O(),height:O()}),P={left:O(),right:O()},H={top:O(),bottom:O()},j=C({size:F,bounds:C(P)}),U=C({size:F,bounds:C(H)}),z=C({size:F,bounds:C({...P,...H})});class q{checkedBorderPixels;promisedMeasureWebView;constructor(e){this.checkedBorderPixels=e,this.promisedMeasureWebView=async function(){const e=new WebView;return await e.loadHTML(""),await e.evaluateJavaScript(`{\n    const e = document.createElement('script');\n    e.onerror = err => console.error(String(err));\n    e.onload = () => completion();\n    e.type = 'module';\n     e.appendChild(document.createTextNode(${JSON.stringify(W)}));\n    document.head.append(e);\n  }`,!0),e}()}async nontransparentWidth(e,t){const n=await this.promisedMeasureWebView,i=JSON.stringify(J("image/png",Data.fromPNG(e))),a=await n.evaluateJavaScript(`measureHorizontalBounds(${i}).then(completion),0`,!0);if(!j(a))throw new Error("measureHorizontalBounds failed");this.checkBorderLR(a,t);const{size:{width:s},bounds:{left:r,right:o}}=a;return(o-r+1)/(s/e.size.width)}async nontransparentHeight(e,t){const n=await this.promisedMeasureWebView,i=JSON.stringify(J("image/png",Data.fromPNG(e))),a=await n.evaluateJavaScript(`measureVerticalBounds(${i}).then(completion),0`,!0);if(!U(a))throw new Error("measureVerticalBounds failed");this.checkBorderTB(a,t);const{size:{height:s},bounds:{top:r,bottom:o}}=a;return(o-r+1)/(s/e.size.height)}async nontransparentBounds(e,t){const n=await this.promisedMeasureWebView,i=JSON.stringify(J("image/png",Data.fromPNG(e))),a=await n.evaluateJavaScript(`measureBounds(${i}).then(completion),0`,!0);if(!z(a))throw new Error("measureBounds failed");this.checkBorderLR(a,t),this.checkBorderTB(a,t);const{size:s,bounds:{left:r,right:o,top:c,bottom:l}}=a,h=s.height/e.size.height;return new Size((o-r+1)/h,(l-c+1)/h)}checkBorderLR({size:{width:e},bounds:{left:t,right:n}},i){t<this.checkedBorderPixels&&console.error(`${i?`${i}: `:""}left checked-border violated: ${t} should be >= ${this.checkedBorderPixels}`),n>=e-this.checkedBorderPixels&&console.error(`${i?`${i}: `:""}right checked-border violated: ${n} should be < ${e-this.checkedBorderPixels}`)}checkBorderTB({size:{height:e},bounds:{top:t,bottom:n}},i){t<this.checkedBorderPixels&&console.error(`${i?`${i}: `:""}top checked-border violated: ${t} should be >= ${this.checkedBorderPixels}`),n>=e-this.checkedBorderPixels&&console.error(`${i?`${i}: `:""}bottom checked-border violated: ${n} should be < ${e-this.checkedBorderPixels}`)}}const G="–";class V{imageMeasurer;constructor(e=new q(3)){this.imageMeasurer=e}async measureString(e,t){const{enWidth:n,lineSpacing:i}=await this.measureEnAndLineSpacing(t);return this.measureString_(e,n,i,t)}async measureString_(e,t,n,i){const a=this.imageMeasurer.checkedBorderPixels/Device.screenScale(),{lineCount:s,longestLine:r}=e.split(/\r\n|\n|\r/).reduce((({lineCount:e,longestLine:t},n)=>({lineCount:++e,longestLine:t=Math.max(t,n.length)})),{lineCount:0,longestLine:0}),o=Math.ceil(t),c=new Size(Math.round(r*t+Math.max(o,a)+a),Math.round(s*n+Math.max(o,a)+t+a));return this.measureString__(e,o,c,i)}async measureString__(e,t,n,i){const a=function(e,t,n,i){try{"number"==typeof n&&(n=new Point(n,n));const a=new DrawContext;return a.respectScreenScale=!0,a.size=t,a.opaque=!1,a.setTextColor(Color.orange()),a.setFont(i),a.drawText(e,n),a.getImage()}catch(n){throw console.error(`error rendering ${JSON.stringify(e)} in ${t.width}x${t.height}`),n}}(e,n,t,i);return await this.imageMeasurer.nontransparentBounds(a,e)}async measureFont(e){const{enWidth:t,enDashHeight:n,lineSpacing:i}=await this.measureEnAndLineSpacing(e),a=async(n,a=t)=>(await this.measureString_(n,a,i,e)).width,s=await(async()=>{const e=" ".repeat(10);return(await a(`a${e}a`)-await a("aa"))/10})(),r=await(async()=>{const e="0123456789–",n=1.25*t;return(await a(e,n)-t)/10})(),o=await(async()=>{const e=Object.entries({a:8,b:2,c:3,d:4,e:13,f:2,g:2,h:6,i:7,j:1,k:1,l:4,m:2,n:7,o:8,p:2,q:1,r:6,s:6,t:9,u:3,v:1,w:2,x:1,y:2,z:1}).map((([e,t])=>e.repeat(t))).join("")+G;return(await a(e)-t)/(e.length-1)})(),c=await(async()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ–",n=1.5*t;return(await a(e,n)-t)/26})();return{enWidth:t,enDashHeight:n,spaceWidth:s,averageDigitWidth:r,averageLowercaseWidth:o,averageUppercaseWidth:c,lineSpacing:i}}async measureEnAndLineSpacing(e){const{width:t,height:n}=await this.measureString_(G,60,100,e),{height:i}=await this.measureString_("–\n–",1.25*t,200,e);return{enWidth:t,enDashHeight:n,lineSpacing:i-n}}}function J(e,t){return`data:${e};base64,${t.toBase64String()}`}function Y(){let e,t;return{promise:new Promise(((n,i)=>{e=n,t=i})),resolve:e,reject:t}}class K{_interval;constructor(e){this._interval=e}subscribers=new Set;subscribe(e){return this.subscribers.add(e),this.maybeStart(),{unsubscribe:()=>this.unsubscribe(e)}}unsubscribe(e){this.subscribers.delete(e),this.maybeStop()}singles=new Map;notifyOnce(){const{promise:e,resolve:t,reject:n}=Y();return this.singles.set(e,{resolve:t,reject:n}),this.maybeStart(),{promise:e,cancel:()=>{this.singles.delete(e),n(new Error("one-time notification canceled")),this.maybeStop()}}}empty(){return this.subscribers.size<=0&&this.singles.size<=0}set interval(e){this._interval=e,this.stop(),e>0&&this.maybeStart()}timer=null;maybeStart(){this.timer||this.empty()||(this.timer=Timer.schedule(this._interval,!0,(()=>this.poll())))}maybeStop(){this.empty()&&this.stop()}stop(){this.timer?.invalidate(),this.timer=null}notify(){const e=this.notificationInfo();null!=e&&(this.subscribers.forEach((t=>{try{t(e.info,(()=>this.unsubscribe(t)))}catch(e){console.error(e)}})),this.singles.forEach((t=>t.resolve(e.info))),this.singles.clear())}}class Q extends K{orientation;constructor(e=1e3){super(e),this.orientation=X()}poll(){const e=this.orientation;this.orientation=X(),e!=this.orientation&&this.notify()}notificationInfo(){return{info:void 0}}}function X(){return Device.isInPortrait()?"portrait":Device.isInPortraitUpsideDown()?"portrait upside down":Device.isInLandscapeLeft()?"landscape left":Device.isInLandscapeRight()?"landscape right":Device.isFaceUp()?"face up":Device.isFaceDown()?"face down":void 0}class Z extends K{measurer;measures;constructor(e=5e3,t,n){super(e),this.measurer=t,this.measures=n}static async create(e=5e3,t=new V){const n=await t.measureFont(Font.body());return new Z(e,t,n)}subscribe(e){return e(this.measures,(()=>this.unsubscribe(e))),super.subscribe(e)}async poll(){const e=await this.measurer.measureEnAndLineSpacing(Font.body());if(this.measures?.enWidth!=e.enWidth||this.measures.lineSpacing!=e.lineSpacing){const e=await this.measurer.measureFont(Font.body());this.measures=e,this.notify()}}notificationInfo(){return{info:this.measures}}}const ee=new Set(Array.from(" !-/?|}").map((e=>e.codePointAt(0))).flatMap((e=>e?[e]:[])));function te(e){return(t,n,i=3*e.enWidth)=>{let a=null;const s=[];let r=0;const o=[],c=(e,n)=>o.push({breakCount:n.length,beforeIndex:e,pointsRemaining:t-r,lastBreakPoints:n.at(n.length-1)?.widthSince??0});for(let o=0;o<n.length;){let l,h=!0,d=!1;const u=n.codePointAt(o);null!=u&&(ee.has(u)&&(d=!0),10==u?(l=0,h=!1,d="forced"):32==u?(l=e.spaceWidth,h=!1):l=97<=u&&u<=122?e.averageLowercaseWidth:65<=u&&u<=90?e.averageUppercaseWidth:e.enWidth,a?r+a.widthSince+l+i>t&&h?(c(a.before,s.splice(0).slice(0,-1)),r=a.widthSince+l,a=null):a.widthSince+=l:r+l+i>t&&h?(c(o,[]),r=l):r+=l,o+=String.fromCodePoint(u).length,"forced"==d?(c(o,s.splice(0)),r=0,a=null):d&&(a&&(r+=a.widthSince),a={before:o,widthSince:0},s.push(a)))}return a&&(r+=a.widthSince),c(n.length,s),o}}async function ne(e,t,n){const i=te(t)(n,e),a=new Alert;function s(e,t=5){return e.length<=2*t+1?e:e.slice(0,t)+"…"+e.slice(-t)}a.title=`${i.length} Estimated Line${1==i.length?"":"s"}`,a.message=i.reduce((({start:n,msg:i},a,r)=>({start:a.beforeIndex,msg:`${i}\n${r+1} ${JSON.stringify(s(e.slice(n,a.beforeIndex)))} ${(a.pointsRemaining/t.enWidth).toFixed(2)}en ${a.breakCount} last ${(a.lastBreakPoints/t.enWidth).toFixed(2)}en`})),{start:0,msg:""}).msg,a.addCancelAction("Close"),await a.presentSheet()}function ie(e,t,n){return Math.round(4+2*t.enWidth+n.lineSpacing*e)}class ae{table;tableClosed;createBuilder;builder;saiVisible;safeAreaInsetsFetcher;presentationsClosed;orientationChangeNotifier;multitaskingSizeChangeNotifier;fontMeasurer;fontChangeNotifier;constructor(e,t,n,i,a,s,r,o,c,l,h){this.table=e,this.tableClosed=t,this.createBuilder=n,this.builder=i,this.saiVisible=a,this.safeAreaInsetsFetcher=s,this.presentationsClosed=r,this.orientationChangeNotifier=o,this.multitaskingSizeChangeNotifier=c,this.fontMeasurer=l,this.fontChangeNotifier=h}static async start(e,t={}){const n={visibleSafeAreaInsetWebView:Device.isPad(),...t},i=await re.create(n.visibleSafeAreaInsetWebView),a=new UITable,s=a.present(!n.visibleSafeAreaInsetWebView).then((()=>"table closed"));s.finally((()=>i.unhideMessage()));const r=new V;return new ae(a,s,e,await e(a,r),n.visibleSafeAreaInsetWebView,i,s.then((()=>i.webviewClosed)),new Q,new oe(i),r,await Z.create(5e3,r))}async startNewTable(){const e=new UITable,t=e.present(!this.saiVisible).then((()=>"table closed")),n=await this.createBuilder(e,this.fontMeasurer);return new ae(e,t,this.createBuilder,n,this.saiVisible,this.safeAreaInsetsFetcher,t.then(),this.orientationChangeNotifier,this.multitaskingSizeChangeNotifier,this.fontMeasurer,this.fontChangeNotifier)}activeLoop;paddingBasedOnScreenSize=!0;async loop(e){const{promise:t,resolve:n}=Y(),i={n:(this.activeLoop?.n??0)+1},a=this.activeLoop;a&&(a.pauseFor?a.pauseFor(t):console.error(`unable to pause loop ${a.n}`)),this.activeLoop=i;try{const t=await this.loopRunner(e,i);return this.activeLoop===i?this.activeLoop=a:null!=t&&console.warn("different loop was active when one finished"),t}finally{n()}}async loopRunner(e,t){let n,i;t.pauseFor=e=>{n=e,i?.("loop again"),e.finally((()=>{n===e&&(n=void 0)}))};const a={again:()=>i("loop again"),return:e=>i({return:e})};let s=await this.fontChangeNotifier.measurer.measureFont(Font.body()),r=!1;const o=this.fontChangeNotifier.subscribe((e=>{s=e,r=!0,i?.("loop again")}));let c=!1,l=Device.screenSize();const h=this.orientationChangeNotifier.subscribe((()=>{const e=Device.screenSize();e.width==l.width&&e.height==l.height||(c=!0,l=e,i?.("loop again"))})),d=this.saiVisible?this.multitaskingSizeChangeNotifier.subscribe((()=>i?.("loop again"))):void 0;try{for(;;){const t=Y();i=t.resolve;const o=await(async o=>{try{if(n)i(n.then((()=>"loop again")));else{const t=Device.screenSize(),{left:n,right:i,top:o,bottom:l,width:h,height:d}=await this.safeAreaInsetsFetcher.getInsetsAndSizeInPoints(),u=(()=>{const e=new Size(h,d);return c||t.height-(e.height+o+l)!=0||t.width-(e.width+n+i)!=0&&![1/3,2/3,.5].map((a=>t.width-(e.width+n+i)/a)).some((e=>0<=e&&e<=20))||(console.log(`adjusting reported windowSize: ${e.width}(+${n+i})x${e.height}(+${o+l})`),e.width+=n+i,e.height+=o+l),e})(),g=this.paddingBasedOnScreenSize?t:u,f=8*Math.floor(Math.min(400,g.width,g.height)/10/8),p=u.width-f-n-i;isFinite(p)?this.builder.rowWidth=p:this.builder.rowWidth=null,r&&(this.builder.bodyFontMeasures=s),r=!1,this.table.removeAllRows(),await e(a,{fontMeasures:s,windowSize:u,safeAreaInsets:{left:n,right:i}}),this.table.reload()}return await o}finally{t.reject("loop iteration ended")}})(Promise.race([this.tableClosed,t.promise]));if("loop again"!=o)return"table closed"==o?null:o.return}}finally{d?.unsubscribe(),h.unsubscribe(),o.unsubscribe()}}}const se=C({left:k(),right:k(),top:k(),bottom:k(),width:O(),height:O()},{extra:C({angle:O(),x:O(),y:O()})});class re{wv;presented;webviewClosed;constructor(e,t,n){this.wv=e,this.presented=t,this.webviewClosed=n}static async create(e=!0,t){const n=new WebView,i=`:root{\n       ${["top","bottom","left","right"].map((e=>`--${e}:env(safe-area-inset-${e});`)).join("")}\n    }\n    #c {\n      margin: var(--top) var(--right) var(--bottom) var(--left);\n    }\n    #m {\n      margin: 0px;\n      font-size: 48px;\n      text-align: center;\n      visibility: hidden;\n    }\n    :root {\n      background-color: white;\n      color: black;\n    }\n    @media (prefers-color-scheme: dark) {\n      :root {\n        background-color: black;\n        color: white;\n      }\n    }`;if(await n.loadHTML(`<head><meta name='viewport' content='viewport-fit=cover, width=device-width'/><style>${i}</style><div id=c><p id=m>This window is for background processing. Please close it.</p></div>`),await n.evaluateJavaScript(`{\n      const s = document.createElement('script');\n      s.onerror = err => console.error(String(err));\n      s.onload = () => completion();\n      s.type = 'module';\n      s.appendChild(document.createTextNode(${JSON.stringify('function getLeftAndRightInsets() {\n  const angle = window.screen.orientation.angle;\n  const cs = getComputedStyle(document.documentElement);\n  const left = cs.getPropertyValue("--left");\n  const right = cs.getPropertyValue("--right");\n  const top = cs.getPropertyValue("--top");\n  const bottom = cs.getPropertyValue("--bottom");\n  const width = window.innerWidth;\n  const height = window.innerHeight;\n  const x = window.screenX;\n  const y = window.screenY;\n  return { left, right, angle, width, height, top, bottom, x, y };\n}\nfunction getStableLeftAndRightInsets() {\n  const interval = 25;\n  const requiredStablePeriods = 4;\n  let queries = 0;\n  let stableFor = 0;\n  let previousInsets;\n  return new Promise(poll);\n  async function poll(resolve, reject) {\n    const insets = getLeftAndRightInsets();\n    queries++;\n    if (previousInsets)\n      if (insets.left == previousInsets.left && insets.right == previousInsets.right) {\n        stableFor++;\n        if (stableFor >= requiredStablePeriods)\n          return resolve(insets);\n      } else\n        stableFor = 0;\n    if (queries > 2 * requiredStablePeriods) {\n      console.error(`giving up on insets: only stable for ${stableFor}/${requiredStablePeriods} after ${queries}`);\n      return reject(new Error(`insets only stable for ${stableFor}/${requiredStablePeriods} after ${queries}`));\n    }\n    previousInsets = insets;\n    setTimeout(poll, interval, resolve, reject);\n  }\n}\n\nObject.assign(globalThis, { getLeftAndRightInsets, getStableLeftAndRightInsets });\n')}));\n      document.head.append(s);\n    }`,!0),t&&await n.evaluateJavaScript(`document.getElementById('m').innerText = ${JSON.stringify(t)}`),e){const e=n.present(!0),t=new Promise((e=>Timer.schedule(10,!1,e)));return new re(n,t,e)}return new re(n,!1,Promise.resolve())}async unhideMessage(){this.presented&&await this.presented,await this.wv.evaluateJavaScript("document.getElementById('m').style.visibility = 'visible'")}warned=!1;async getInsetsEtc(){this.presented&&await this.presented;const e=await(async()=>{for(;;){const e=await this.wv.evaluateJavaScript("void getStableLeftAndRightInsets().then(completion,()=>completion(null))",!0);if(null!=e)return e}})();if(!se(e))throw new Error(`expected Record<'left'|'right'|'top'|'bottom',string>&Record<'width'|'height',number> for from web code (got ${JSON.stringify(e)})`);if(!this.presented)if(e.right!=e.left&&(e.right=e.left),Device.isPad())this.warned||(console.warn("Safe Area Inset WebView must be presented on devices that offer multitasking (iPads)"),this.warned=!0);else{const t=Device.screenSize();e.width=t.width,e.height=t.height}return e}async getLeftAndRightInPoints(){const{left:e,right:t}=await this.getInsetsEtc();return{left:parseInt(e),right:parseInt(t)}}async getInsetsAndSizeInPoints(){const{left:e,right:t,top:n,bottom:i,width:a,height:s}=await this.getInsetsEtc();return{left:parseInt(e),right:parseInt(t),top:parseInt(n),bottom:parseInt(i),width:a,height:s}}}class oe extends K{sai;constructor(e,t=1e3){super(t),this.sai=e}size=null;async poll(){const{width:e,height:t}=await this.sai.getInsetsEtc();e==this.size?.width&&t==this.size?.height||(this.size=new Size(e,t),this.notify())}notificationInfo(){return this.size&&{info:this.size}}}function ce(e){throw"assertNever called"}function le(e,t,n=2){const i=e.reduce(((e,t)=>e+Math.abs(t.widthWeight)||NaN),0);if(!isFinite(i)||0==i)throw new RangeError("each apportioned widthWeight must be finite and non-zero");return n&&(t-=n*(e.length-1)),e.map((e=>({...e,width:Math.round(Math.abs(e.widthWeight)/i*t)})))}const he=Object.freeze(new Set(["largeTitle","title1","title2","title3","headline","subheadline","body","callout","footnote","caption1","caption2"]));function de(e){return he.has(e)}function ue(e,t={}){return"string"==typeof e?{type:"text",...t,title:e}:{type:"text",...t,...e}}function ge(e){return e?"string"==typeof e&&de(e)?Font[e]():e:Font.body()}function fe(e){const t=(()=>{if("text"==e.type){const t=UITableCell.text(e.title,e.subtitle);return"__ undefined __"!=e.titleFont&&(t.titleFont=ge(e.titleFont)),e.titleColor&&(t.titleColor=e.titleColor),t}if("button"==e.type){const t=UITableCell.button(e.title);return t.onTap=e.onTap,t}if("image"==e.type)return UITableCell.image(e.image);ce()})();return e.align&&t[`${e.align}Aligned`](),e.widthWeight&&(t.widthWeight=e.widthWeight),t}const pe=new Set(["xmark","checkmark","checkmark.square","square","questionmark","questionmark.circle","questionmark.square","chevron.backward","chevron.forward","arrowtriangle.right.square.fill","arrowtriangle.down.square.fill","magnifyingglass","doc.on.clipboard","doc","gear","largecircle.fill.circle","circle"]);function me(e,t){const n=SFSymbol.named(e).image;return{image:n,width:Math.floor(t/n.size.height*n.size.width)}}function we(e,t){const{image:n,width:i}=me(e,t);return{type:"image",image:n,widthWeight:i,rowHeight:Se(t)}}function be(e,t){const n=e.map((e=>we(e,t))),i=Math.max(...n.map((e=>e.widthWeight)));return{symbols:n,maxSymbolWidth:i}}function ye(e,t,n=2){const i=e-t.widthWeight;if(i<=n+1)return[t];if(!t.align||"left"==t.align)return[t,{type:"text",title:"",widthWeight:i-n}];if("right"==t.align)return[{type:"text",title:"",widthWeight:i-n},t];if(i<2*(n+1))return[{type:"text",title:"",widthWeight:i-n},t];const a=i-2*n,s=Math.trunc(a/2);return[{type:"text",title:"",widthWeight:s},t,{type:"text",title:"",widthWeight:a-s}]}function ve(e){return e-16}function Se(e){return e+16}function Ie(e,...t){const n=Math.max(...t.filter((e=>"number"==typeof e)));return e?Math.max(44,n):n}class Re{constructor(e,t,n){this.table=e,this.fontMeasurer=t,this.fontMeasureCache.set("body",n)}title="Untitled UI";static async create(e,t=new V){return new Re(e,t,await t.measureFont(Font.body()))}_rowWidth=null;set rowWidth(e){this._rowWidth=e}get rowWidth(){if(null!=this._rowWidth)return this._rowWidth;const e=Device.screenSize();if(Device.isPad())return e.width-40;const t=e.width<e.height;return e.width-40-(t?0:96)}fontMeasureCache=new Map;set bodyFontMeasures(e){const t=this.fontMeasureCache.get("body");t&&t.enWidth==e.enWidth&&t.lineSpacing==e.lineSpacing||(this.fontMeasureCache.clear(),this.fontMeasureCache.set("body",e))}async fontMeasures(e){if(e&&"__ undefined __"!=e||(e="body"),"string"==typeof e&&de(e)){const t=this.fontMeasureCache.get(e);if(t)return t;const n=await this.fontMeasurer.measureFont(ge(e));return this.fontMeasureCache.set(e,n),n}return await this.fontMeasurer.measureFont(e)}remainingWidth(e,t=2){return this.rowWidth-e.reduce(((e,t)=>e+t),0)-t*e.length}extraLineEvery;async estimatedHeightOfTextCell(e,t){return function(e,t,n,i,a){const s=te(n)(i,e).length;return ie(a?Math.trunc(s*(1+1/a)):s,t,n)}(e.title,await this.fontMeasures("body"),await this.fontMeasures(e.titleFont),t,this.extraLineEvery)}async defaultSymbolRowHeight(){const e=await this.fontMeasures();return ie(1,e,e)}inspections=!1;interposeInspection(e,t,n){return this.inspections?async()=>{if(n){const e=new Alert;e.title="Inspect Line Breaks?",e.message="Line break inspection is enabled, but the row you tapped has an action it would normally perform.\n\nDo you want to inspect the text's line breaks, or do the row's normal action?",e.addAction("Inspect"),e.addCancelAction("Do Normal Action");if(-1==await e.present())return n()}let i=0;for(const n of e)await ne(n.title,await this.fontMeasures(n.titleFont),t[i++])}:n}addRow(e){const t=function(e){const t=new UITableRow;return e?.onSelect&&(t.onSelect=e.onSelect,t.dismissOnSelect=!1),e?.dismissOnSelect&&(t.dismissOnSelect=e.dismissOnSelect),e?.height&&(t.height=e.height),e?.cellSpacing&&(t.cellSpacing=e.cellSpacing),e?.backgroundColor&&(t.backgroundColor=e.backgroundColor),t}(e);return this.table.addRow(t),t}addHeightAdjuster(e,t=(()=>this.table.reload())){const n=n=>()=>{e.height+=n,t(e.height)},i=fe({type:"button",title:"-1",align:"left",onTap:n(-1)}),a=fe({type:"button",title:"-10",align:"left",onTap:n(-10)}),s=fe({type:"button",title:"show/set",align:"center",onTap:async()=>{const n=new Alert;n.title="Current Height",n.message=`The current height is ${e.height}.\n\nEnter a new height:`;n.addTextField("new height",String(e.height)).setNumberPadKeyboard(),n.addCancelAction("Okay"),await n.presentAlert();const i=parseInt(n.textFieldValue(0));i>0&&(e.height=i,t(e.height))}}),r=fe({type:"button",title:"+10",align:"right",onTap:n(10)}),o=fe({type:"button",title:"+1",align:"right",onTap:n(1)});return this.addRowWithCells([i,a,s,r,o])}addRowWithCells(e,t){const n=this.addRow(t);return e.forEach((e=>n.addCell(e))),n}async addCenteredTextWithExtrasRow(e,t,n,i){const a=new Array,s=Math.max(t?.widthWeight??0,n?.widthWeight??0);t?a.push(...ye(s,{...t,align:"left"},i?.cellSpacing)):s>0&&a.push({type:"text",title:"",widthWeight:s});const r=ue(e),o=this.remainingWidth([...t||s>0?[s]:[],...n||s>0?[s]:[]]),c=Ie(!!i?.onSelect,t?.rowHeight,n?.rowHeight,await this.estimatedHeightOfTextCell(r,o));return a.push({...r,align:"center",widthWeight:o}),n?a.push(...ye(s,{...n,align:"right"},i?.cellSpacing)):s>0&&a.push({type:"text",title:"",widthWeight:s}),this.addRowWithCells(a.map(fe),{height:c,...i,onSelect:this.interposeInspection([r],[o],i?.onSelect)})}async addTitleConfigRow(e){const t=we("gear",ve(await this.defaultSymbolRowHeight()));return t.widthWeight=Math.trunc(.75*t.widthWeight),this.addCenteredTextWithExtrasRow(ue(this.title,{titleFont:"title2"}),void 0,e?t:void 0,{onSelect:e})}async addSymbolExamples(){const e=await this.defaultSymbolRowHeight(),t=ve(e);pe.forEach((n=>{const{image:i,width:a}=me(n,t);console.log(n),console.log(i.size);const s=a/i.size.width,r=t/i.size.height;console.log(`ww:${a}pt ws:${s.toFixed(2)} hs:${r.toFixed(2)}`);const o=new Array(9).fill(0).map(((...[,e])=>a-4+e)),c=this.remainingWidth([...o,5,5],0);(c<1||c!=Math.trunc(c))&&console.warn("problematic remaining value: ${remaining}");const l=o.map((e=>({type:"image",image:i,align:"center",widthWeight:e})));l.splice(4,0,{type:"text",title:"|",align:"right",widthWeight:5}),l.splice(6,0,{type:"text",title:"|",align:"left",widthWeight:5}),l.push({type:"text",title:".",align:"left",widthWeight:c}),this.addRowWithCells(l.map(fe),{height:e,cellSpacing:0})}))}async addFontExamples(){const e=this.rowWidth;await Array.from(he).reduce((async(t,n)=>{await t;const i=n+" example",a=await this.fontMeasures(n);await this.addTextRow({title:i,titleFont:n},{onSelect:()=>ne(i,a,e)})}),Promise.resolve())}async addBackRow(e,t){const n=we("chevron.backward",ve(await this.defaultSymbolRowHeight())),i=this.remainingWidth([n.widthWeight]),a=ue(e),s=Ie(!0,n.rowHeight,await this.estimatedHeightOfTextCell(a,i));return this.addRowWithCells([fe({...n,align:"right"}),fe({...a,align:"left",widthWeight:i})],{height:s,onSelect:this.interposeInspection([a],[i],t)})}async addSubtitleHelpRow(e,t,n){const i=ue(e,{titleFont:"title2"}),a=i.title;let s;t&&(s=async()=>{const e=new Array;n&&Object.entries(n).forEach((([t,n])=>{if(!t||!n)return;const i="string"==typeof n?{text:n,link:void 0}:n;e.push([t,i])}));let i=a,s={text:t,link:void 0};for(e.push([a,s]);;){const t=new Alert;t.title=this.title+"\n"+a+"\n"+(i==a?"":i+"\n"),t.message=s.text,s.link&&t.addAction("open "+i+" page");const n=e.filter((([e])=>e!=i));n.forEach((([e])=>{t.addAction(e+" Help")})),t.addCancelAction("Okay");let r=await t.presentSheet();if(-1==r)return;if(s.link){if(0==r)return Safari.open(s.link);r-=1}[i,s]=n[r]}});const r=we("questionmark.circle",ve(await this.defaultSymbolRowHeight()));return this.addCenteredTextWithExtrasRow(i,void 0,s?r:void 0,{onSelect:s})}addEmptyRow(){return this.addRow()}async addTextRow(e,t={}){const n=ue(e),i=await this.estimatedHeightOfTextCell(n,this.rowWidth);return this.addRowWithCells([fe(n)],{height:i,...t,onSelect:this.interposeInspection([n],[this.rowWidth],t.onSelect)})}async addIndentRow(e,t={},n=!0){const i=ue(e),a=[{type:"text",title:"",widthWeight:1},{...i,widthWeight:9,align:n?"left":"right"}],[,{width:s}]=le(a,this.rowWidth,t.cellSpacing),r=await this.estimatedHeightOfTextCell(i,s);return n||a.reverse(),this.addRowWithCells(a.map(fe),{height:r,...t,onSelect:this.interposeInspection([i],[s],t.onSelect)})}async addForwardRow(e,t){const{symbols:n,maxSymbolWidth:i}=be(["xmark","chevron.forward"],ve(await this.defaultSymbolRowHeight())),a=n[Number(!!t)],s=this.remainingWidth([a.widthWeight]),r=ue(e),o=Ie(!!t,a.rowHeight,await this.estimatedHeightOfTextCell(r,s)),c=[{...r,align:"right",widthWeight:s},...ye(i,{...a,align:"left"})];return this.addRowWithCells(c.map(fe),{height:o,onSelect:this.interposeInspection([r],[s],t)})}async addCheckableRow(e,t,n,i=!0){const a=ve(await this.defaultSymbolRowHeight()),{symbols:[s,r],maxSymbolWidth:o}=be(i?["checkmark.square","square"]:["largecircle.fill.circle","circle"],a),c=t?s:r,l=this.remainingWidth([c.widthWeight]),h=ue(e),d=Ie(!0,c.rowHeight,await this.estimatedHeightOfTextCell(h,l)),u=[{...h,align:"right",widthWeight:l},...ye(o,{...c,align:"left"})];return this.addRowWithCells(u.map(fe),{height:d,onSelect:this.interposeInspection([h],[l],n)})}async adderForTextWithIconRow(e){const{symbols:t,maxSymbolWidth:n}=be(e,ve(await this.defaultSymbolRowHeight())),i=t.map((e=>({...e,align:"right"})));return async(e,t,a)=>{const s=ue(e),r=i[t],o=this.remainingWidth([r.widthWeight]),c=Ie(!0,r.rowHeight,await this.estimatedHeightOfTextCell(s,o)),l=[{...s,widthWeight:o,align:"right"},...ye(n,r)];return this.addRowWithCells(l.map(fe),{height:c,onSelect:this.interposeInspection([s],[o],a)})}}adderForTableRow(e){return async(t,n={})=>{if(t.length!=e.length)throw`expected ${e.length} columns, got ${t.length}`;const i=le(e,this.rowWidth,n.cellSpacing).map((e=>e.width)),a=t.map(((t,n)=>({...ue(t),...e[n],widthWeight:i[n]}))),s=(await Promise.all(a.map((async e=>this.estimatedHeightOfTextCell(e,e.widthWeight))))).reduce(((e,t)=>Math.max(e,t)));return this.addRowWithCells(a.map(fe),{height:s,...n,onSelect:this.interposeInspection(a,i,n.onSelect)})}}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Te(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ee(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})})),n}var ke={exports:{}},Oe=Ee(Object.freeze({__proto__:null,default:{}})),Ne=Te(ke.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{};function n(){var n=t.URL||t.webkitURL||null,i=e.toString();return o.BLOB_URL||(o.BLOB_URL=n.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",i,")();"],{type:"text/javascript"})))}var i=!t.document&&!!t.postMessage,a=t.IS_PAPA_WORKER||!1,s={},r=0,o={};if(o.parse=l,o.unparse=h,o.RECORD_SEP=String.fromCharCode(30),o.UNIT_SEP=String.fromCharCode(31),o.BYTE_ORDER_MARK="\ufeff",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!i&&!!t.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=y,o.ParserHandle=w,o.NetworkStreamer=u,o.FileStreamer=g,o.StringStreamer=f,o.ReadableStreamStreamer=p,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(o.DuplexStreamStreamer=m),t.jQuery){var c=t.jQuery;c.fn.parse=function(e){var n=e.config||{},i=[];return this.each((function(e){if("INPUT"!==c(this).prop("tagName").toUpperCase()||"file"!==c(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var a=0;a<this.files.length;a++)i.push({file:this.files[a],inputElem:this,instanceConfig:c.extend({},n)})})),a(),this;function a(){if(0!==i.length){var t=i[0];if(O(e.before)){var n=e.before(t.file,t.inputElem);if("object"==typeof n){if("abort"===n.action)return void s("AbortError",t.file,t.inputElem,n.reason);if("skip"===n.action)return void r();"object"==typeof n.config&&(t.instanceConfig=c.extend(t.instanceConfig,n.config))}else if("skip"===n)return void r()}var a=t.instanceConfig.complete;t.instanceConfig.complete=function(e){O(a)&&a(e,t.file,t.inputElem),r()},o.parse(t.file,t.instanceConfig)}else O(e.complete)&&e.complete()}function s(t,n,i,a){O(e.error)&&e.error({name:t},n,i,a)}function r(){i.splice(0,1),a()}}}function l(e,n){var i=(n=n||{}).dynamicTyping||!1;if(O(i)&&(n.dynamicTypingFunction=i,i={}),n.dynamicTyping=i,n.transform=!!O(n.transform)&&n.transform,n.worker&&o.WORKERS_SUPPORTED){var a=v();return a.userStep=n.step,a.userChunk=n.chunk,a.userComplete=n.complete,a.userError=n.error,n.step=O(n.step),n.chunk=O(n.chunk),n.complete=O(n.complete),n.error=O(n.error),delete n.worker,void a.postMessage({input:e,config:n,workerId:a.id})}var s=null;return e===o.NODE_STREAM_INPUT&&"undefined"==typeof PAPA_BROWSER_CONTEXT?(s=new m(n)).getStream():("string"==typeof e?(e=r(e),s=n.download?new u(n):new f(n)):!0===e.readable&&O(e.read)&&O(e.on)?s=new p(n):(t.File&&e instanceof File||e instanceof Object)&&(s=new g(n)),s.stream(e));function r(e){return 65279===e.charCodeAt(0)?e.slice(1):e}}function h(e,t){var n=!1,i=!0,a=",",s="\r\n",r='"',c=r+r,l=!1,h=null,d=!1;g();var u=new RegExp(b(r),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,l);if("object"==typeof e[0])return f(h||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||h),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function g(){if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(a=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(r=t.quoteChar),"boolean"==typeof t.header&&(i=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");h=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+r),("boolean"==typeof t.escapeFormulae||t.escapeFormulae instanceof RegExp)&&(d=t.escapeFormulae instanceof RegExp?t.escapeFormulae:/^[=+\-@\t\r].*$/)}}function f(e,t,n){var r="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var o=Array.isArray(e)&&e.length>0,c=!Array.isArray(t[0]);if(o&&i){for(var l=0;l<e.length;l++)l>0&&(r+=a),r+=p(e[l],l);t.length>0&&(r+=s)}for(var h=0;h<t.length;h++){var d=o?e.length:t[h].length,u=!1,g=o?0===Object.keys(t[h]).length:0===t[h].length;if(n&&!o&&(u="greedy"===n?""===t[h].join("").trim():1===t[h].length&&0===t[h][0].length),"greedy"===n&&o){for(var f=[],m=0;m<d;m++){var w=c?e[m]:m;f.push(t[h][w])}u=""===f.join("").trim()}if(!u){for(var b=0;b<d;b++){b>0&&!g&&(r+=a);var y=o&&c?e[b]:b;r+=p(t[h][y],b)}h<t.length-1&&(!n||d>0&&!g)&&(r+=s)}}return r}function p(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var i=!1;d&&"string"==typeof e&&d.test(e)&&(e="'"+e,i=!0);var s=e.toString().replace(u,c);return(i=i||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||m(s,o.BAD_DELIMITERS)||s.indexOf(a)>-1||" "===s.charAt(0)||" "===s.charAt(s.length-1))?r+s+r:s}function m(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return!0;return!1}}function d(e){function n(e){var t=E(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new w(t),this._handle.streamer=this,this._config=t}this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},n.call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&O(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var s=this._partialLine+e;this._partialLine="";var r=this._handle.parse(s,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=r.meta.cursor;this._finished||(this._partialLine=s.substring(c-this._baseIndex),this._baseIndex=c),r&&r.data&&(this._rowCount+=r.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(a)t.postMessage({results:r,workerId:o.WORKER_ID,finished:l});else if(O(this._config.chunk)&&!n){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);r=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),this._completed||!l||!O(this._config.complete)||r&&r.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||r&&r.meta.paused||this._nextChunk(),r}this._halted=!0},this._sendError=function(e){O(this._config.error)?this._config.error(e):a&&this._config.error&&t.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function u(e){var t;function n(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),d.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=k(this._chunkLoaded,this),t.onerror=k(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var a=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+a)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}i&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||t.status>=400?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=n(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function g(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),d.call(this,e);var i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=k(this._chunkLoaded,this),t.onerror=k(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var a=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,a)}var s=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function f(e){var t;e=e||{},d.call(this,e),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function p(e){e=e||{},d.call(this,e);var t=[],n=!0,i=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=k((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=k((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=k((function(){this._streamCleanUp(),i=!0,this._streamData("")}),this),this._streamCleanUp=k((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function m(e){var t=Oe.Duplex,n=E(e),i=!0,a=!1,s=[],r=null;this._onCsvData=function(e){var t=e.data;r.push(t)||this._handle.paused()||this._handle.pause()},this._onCsvComplete=function(){r.push(null)},n.step=k(this._onCsvData,this),n.complete=k(this._onCsvComplete,this),d.call(this,n),this._nextChunk=function(){a&&1===s.length&&(this._finished=!0),s.length?s.shift()():i=!0},this._addToParseQueue=function(e,t){s.push(k((function(){if(this.parseChunk("string"==typeof e?e:e.toString(n.encoding)),O(t))return t()}),this)),i&&(i=!1,this._nextChunk())},this._onRead=function(){this._handle.paused()&&this._handle.resume()},this._onWrite=function(e,t,n){this._addToParseQueue(e,n)},this._onWriteComplete=function(){a=!0,this._addToParseQueue("")},this.getStream=function(){return r},(r=new t({readableObjectMode:!0,decodeStrings:!1,read:k(this._onRead,this),write:k(this._onWrite,this)})).once("finish",k(this._onWriteComplete,this))}function w(e){var t,n,i,a=Math.pow(2,53),s=-a,r=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,c=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,h=0,d=0,u=!1,g=!1,f=[],p={data:[],errors:[],meta:{}};if(O(e.step)){var m=e.step;e.step=function(t){if(p=t,I())S();else{if(S(),0===p.data.length)return;h+=t.data.length,e.preview&&h>e.preview?n.abort():(p.data=p.data[0],m(p,l))}}}function w(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function v(e){if(r.test(e)){var t=parseFloat(e);if(t>s&&t<a)return!0}return!1}function S(){return p&&i&&(C("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),i=!1),e.skipEmptyLines&&(p.data=p.data.filter((function(e){return!w(e)}))),I()&&R(),N()}function I(){return e.header&&0===f.length}function R(){if(p)if(Array.isArray(p.data[0])){for(var t=0;I()&&t<p.data.length;t++)p.data[t].forEach(n);p.data.splice(0,1)}else p.data.forEach(n);function n(t,n){O(e.transformHeader)&&(t=e.transformHeader(t,n)),f.push(t)}}function T(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}function k(e,t){return T(e)?"true"===t||"TRUE"===t||"false"!==t&&"FALSE"!==t&&(v(t)?parseFloat(t):c.test(t)?new Date(t):""===t?null:t):t}function N(){if(!p||!e.header&&!e.dynamicTyping&&!e.transform)return p;function t(t,n){var i,a=e.header?{}:[];for(i=0;i<t.length;i++){var s=i,r=t[i];e.header&&(s=i>=f.length?"__parsed_extra":f[i]),e.transform&&(r=e.transform(r,s)),r=k(s,r),"__parsed_extra"===s?(a[s]=a[s]||[],a[s].push(r)):a[s]=r}return e.header&&(i>f.length?C("FieldMismatch","TooManyFields","Too many fields: expected "+f.length+" fields but parsed "+i,d+n):i<f.length&&C("FieldMismatch","TooFewFields","Too few fields: expected "+f.length+" fields but parsed "+i,d+n)),a}var n=1;return!p.data.length||Array.isArray(p.data[0])?(p.data=p.data.map(t),n=p.data.length):p.data=t(p.data,0),e.header&&p.meta&&(p.meta.fields=f),d+=n,p}function A(t,n,i,a,s){var r,c,l,h;s=s||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var d=0;d<s.length;d++){var u=s[d],g=0,f=0,p=0;l=void 0;for(var m=new y({comments:a,delimiter:u,newline:n,preview:10}).parse(t),b=0;b<m.data.length;b++)if(i&&w(m.data[b]))p++;else{var v=m.data[b].length;f+=v,void 0!==l?v>0&&(g+=Math.abs(v-l),l=v):l=v}m.data.length>0&&(f/=m.data.length-p),(void 0===c||g<=c)&&(void 0===h||f>h)&&f>1.99&&(c=g,r=u,h=f)}return e.delimiter=r,{successful:!!r,bestDelimiter:r}}function x(e,t){e=e.substring(0,1048576);var n=new RegExp(b(t)+"([^]*?)"+b(t),"gm"),i=(e=e.replace(n,"")).split("\r"),a=e.split("\n"),s=a.length>1&&a[0].length<i[0].length;if(1===i.length||s)return"\n";for(var r=0,o=0;o<i.length;o++)"\n"===i[o][0]&&r++;return r>=i.length/2?"\r\n":"\r"}function C(e,t,n,i){var a={type:e,code:t,message:n};void 0!==i&&(a.row=i),p.errors.push(a)}this.parse=function(a,s,r){var c=e.quoteChar||'"';if(e.newline||(e.newline=x(a,c)),i=!1,e.delimiter)O(e.delimiter)&&(e.delimiter=e.delimiter(a),p.meta.delimiter=e.delimiter);else{var l=A(a,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(i=!0,e.delimiter=o.DefaultDelimiter),p.meta.delimiter=e.delimiter}var h=E(e);return e.preview&&e.header&&h.preview++,t=a,n=new y(h),p=n.parse(t,s,r),S(),u?{meta:{paused:!0}}:p||{meta:{paused:!1}}},this.paused=function(){return u},this.pause=function(){u=!0,n.abort(),t=O(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(u=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,n.abort(),p.meta.aborted=!0,O(e.complete)&&e.complete(p),t=""}}function b(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(e){var t,n=(e=e||{}).delimiter,i=e.newline,a=e.comments,s=e.step,r=e.preview,c=e.fastMode,l=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof n||o.BAD_DELIMITERS.indexOf(n)>-1)&&(n=","),a===n)throw new Error("Comment character same as delimiter");!0===a?a="#":("string"!=typeof a||o.BAD_DELIMITERS.indexOf(a)>-1)&&(a=!1),"\n"!==i&&"\r"!==i&&"\r\n"!==i&&(i="\n");var h=0,d=!1;this.parse=function(o,u,g){if("string"!=typeof o)throw new Error("Input must be a string");var f=o.length,p=n.length,m=i.length,w=a.length,y=O(s);h=0;var v=[],S=[],I=[],R=0;if(!o)return V();if(e.header&&!u){var T=o.split(i)[0].split(n),E="_",k=[],N={},A=!1;for(var x in T){var C=T[x];O(e.transformHeader)&&(C=e.transformHeader(C,x));var B=C,_=N[C]||0;for(_>0&&(A=!0,B=C+E+_),N[C]=_+1;k.includes(B);)B=B+E+_;k.push(B)}if(A){var D=o.split(i);D[0]=k.join(n),o=D.join(i)}}if(c||!1!==c&&-1===o.indexOf(t)){for(var M=o.split(i),$=0;$<M.length;$++){if(I=M[$],h+=I.length,$!==M.length-1)h+=i.length;else if(g)return V();if(!a||I.substring(0,w)!==a){if(y){if(v=[],U(I.split(n)),J(),d)return V()}else U(I.split(n));if(r&&$>=r)return v=v.slice(0,r),V(!0)}}return V()}for(var L=o.indexOf(n,h),W=o.indexOf(i,h),F=new RegExp(b(l)+b(t),"g"),P=o.indexOf(t,h);;)if(o[h]!==t)if(a&&0===I.length&&o.substring(h,h+w)===a){if(-1===W)return V();h=W+m,W=o.indexOf(i,h),L=o.indexOf(n,h)}else if(-1!==L&&(L<W||-1===W))I.push(o.substring(h,L)),h=L+p,L=o.indexOf(n,h);else{if(-1===W)break;if(I.push(o.substring(h,W)),G(W+m),y&&(J(),d))return V();if(r&&v.length>=r)return V(!0)}else for(P=h,h++;;){if(-1===(P=o.indexOf(t,P+1)))return g||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:v.length,index:h}),q();if(P===f-1)return q(o.substring(h,P).replace(F,t));if(t!==l||o[P+1]!==l){if(t===l||0===P||o[P-1]!==l){-1!==L&&L<P+1&&(L=o.indexOf(n,P+1)),-1!==W&&W<P+1&&(W=o.indexOf(i,P+1));var H=z(-1===W?L:Math.min(L,W));if(o.substr(P+1+H,p)===n){I.push(o.substring(h,P).replace(F,t)),h=P+1+H+p,o[P+1+H+p]!==t&&(P=o.indexOf(t,h)),L=o.indexOf(n,h),W=o.indexOf(i,h);break}var j=z(W);if(o.substring(P+1+j,P+1+j+m)===i){if(I.push(o.substring(h,P).replace(F,t)),G(P+1+j+m),L=o.indexOf(n,h),P=o.indexOf(t,h),y&&(J(),d))return V();if(r&&v.length>=r)return V(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:v.length,index:h}),P++}}else P++}return q();function U(e){v.push(e),R=h}function z(e){var t=0;if(-1!==e){var n=o.substring(P+1,e);n&&""===n.trim()&&(t=n.length)}return t}function q(e){return g||(void 0===e&&(e=o.substring(h)),I.push(e),h=f,U(I),y&&J()),V()}function G(e){h=e,U(I),I=[],W=o.indexOf(i,h)}function V(e){return{data:v,errors:S,meta:{delimiter:n,linebreak:i,aborted:d,truncated:!!e,cursor:R+(u||0)}}}function J(){s(V()),v=[],S=[]}},this.abort=function(){d=!0},this.getCharIndex=function(){return h}}function v(){if(!o.WORKERS_SUPPORTED)return!1;var e=n(),i=new t.Worker(e);return i.onmessage=S,i.id=r++,s[i.id]=i,i}function S(e){var t=e.data,n=s[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){i=!0,I(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:R,resume:R};if(O(n.userStep)){for(var r=0;r<t.results.data.length&&(n.userStep({data:t.results.data[r],errors:t.results.errors,meta:t.results.meta},a),!i);r++);delete t.results}else O(n.userChunk)&&(n.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!i&&I(t.workerId,t.results)}function I(e,t){var n=s[e];O(n.userComplete)&&n.userComplete(t),n.terminate(),delete s[e]}function R(){throw new Error("Not implemented.")}function T(e){var n=e.data;if(void 0===o.WORKER_ID&&n&&(o.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:o.WORKER_ID,results:o.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var i=o.parse(n.input,n.config);i&&t.postMessage({workerId:o.WORKER_ID,results:i,finished:!0})}}function E(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=E(e[n]);return t}function k(e,t){return function(){e.apply(t,arguments)}}function O(e){return"function"==typeof e}return a&&(t.onmessage=T),u.prototype=Object.create(d.prototype),u.prototype.constructor=u,g.prototype=Object.create(d.prototype),g.prototype.constructor=g,f.prototype=Object.create(f.prototype),f.prototype.constructor=f,p.prototype=Object.create(d.prototype),p.prototype.constructor=p,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(m.prototype=Object.create(d.prototype),m.prototype.constructor=m),o}());const{parse:Ae,unparse:xe}=Ne;async function Ce(e){return new Promise((t=>{const n=new Array;!function(e,t){let n,i=!1;Ae(e,{step:function(e){if(e.errors?.length>0)throw{error:"ParseError",offset:e.meta.cursor,details:e.errors};{const a=e.data;if(1==a.length&&""==a[0])i=!0;else if(n){i&&(t.row({},{empty:!0,offset:e.meta.cursor,extraColumns:[],missingColumns:n}),i=!1);const s=Object.fromEntries(n.flatMap(((e,t)=>t>=a.length?[]:[[e,a[t]]]))),r={offset:e.meta.cursor,missingColumns:[],extraColumns:[]};a.length>n.length?r.extraColumns=a.slice(n.length):a.length<n.length&&(r.missingColumns=n.slice(a.length)),t.row(s,r)}else n=Object.freeze(a)}},complete(){t.done?.()}})}(e,{row(e){n.push(e)},done(){t(n)}})}))}var Be,_e;function De(){return _e?Be:(_e=1,Be={"978-0":{name:"English language",ranges:[["00","19"],["200","227"],["2280","2289"],["229","368"],["3690","3699"],["370","638"],["6390","6397"],["6398000","6399999"],["640","644"],["6450000","6459999"],["646","647"],["6480000","6489999"],["649","654"],["6550","6559"],["656","699"],["7000","8499"],["85000","89999"],["900000","949999"],["9500000","9999999"]]},"978-1":{name:"English language",ranges:[["000","009"],["01","02"],["030","034"],["0350","0399"],["040","049"],["05","06"],["0700","0999"],["100","397"],["3980","5499"],["55000","64999"],["6500","6799"],["68000","68599"],["6860","7139"],["714","716"],["7170","7319"],["7320000","7399999"],["74000","77499"],["7750000","7753999"],["77540","77639"],["7764000","7764999"],["77650","77699"],["7770000","7782999"],["77830","78999"],["7900","7999"],["80000","80049"],["80050","80499"],["80500","83799"],["8380000","8384999"],["83850","86719"],["8672","8675"],["86760","86979"],["869800","915999"],["9160000","9165059"],["916506","916869"],["9168700","9169079"],["916908","919599"],["9196000","9196549"],["919655","972999"],["9730","9877"],["987800","991149"],["9911500","9911999"],["991200","998989"],["9989900","9999999"]]},"978-2":{name:"French language",ranges:[["00","19"],["200","349"],["35000","39999"],["400","486"],["487000","494999"],["495","495"],["4960","4966"],["49670","49699"],["497","527"],["5280","5299"],["530","699"],["7000","8399"],["84000","89999"],["900000","919799"],["91980","91980"],["919810","919942"],["9199430","9199689"],["919969","949999"],["9500000","9999999"]]},"978-3":{name:"German language",ranges:[["00","02"],["030","033"],["0340","0369"],["03700","03999"],["04","19"],["200","699"],["7000","8499"],["85000","89999"],["900000","949999"],["9500000","9539999"],["95400","96999"],["9700000","9849999"],["98500","99999"]]},"978-4":{name:"Japan",ranges:[["00","19"],["200","699"],["7000","8499"],["85000","89999"],["900000","949999"],["9500000","9999999"]]},"978-5":{name:"former U.S.S.R",ranges:[["00000","00499"],["0050","0099"],["01","19"],["200","361"],["3620","3623"],["36240","36299"],["363","420"],["4210","4299"],["430","430"],["4310","4399"],["440","440"],["4410","4499"],["450","603"],["6040000","6049999"],["605","699"],["7000","8499"],["85000","89999"],["900000","909999"],["91000","91999"],["9200","9299"],["93000","94999"],["9500000","9500999"],["9501","9799"],["98000","98999"],["9900000","9909999"],["9910","9999"]]},"978-600":{name:"Iran",ranges:[["00","09"],["100","499"],["5000","8999"],["90000","98679"],["9868","9929"],["993","995"],["99600","99999"]]},"978-601":{name:"Kazakhstan",ranges:[["00","19"],["200","699"],["7000","7999"],["80000","84999"],["85","99"]]},"978-602":{name:"Indonesia",ranges:[["00","06"],["0700","1399"],["14000","14999"],["1500","1699"],["17000","19999"],["200","499"],["50000","53999"],["5400","5999"],["60000","61999"],["6200","6999"],["70000","74999"],["7500","9499"],["95000","99999"]]},"978-603":{name:"Saudi Arabia",ranges:[["00","04"],["05","49"],["500","799"],["8000","8999"],["90000","99999"]]},"978-604":{name:"Vietnam",ranges:[["0","2"],["300","399"],["40","46"],["470","497"],["4980","4999"],["50","89"],["900","979"],["9800","9999"]]},"978-605":{name:"Turkey",ranges:[["00","02"],["030","039"],["04","05"],["06000","06999"],["07","09"],["100","199"],["2000","2399"],["240","399"],["4000","5999"],["60000","74999"],["7500","7999"],["80000","89999"],["9000","9999"]]},"978-606":{name:"Romania",ranges:[["000","099"],["10","49"],["500","799"],["8000","9099"],["910","919"],["92000","95999"],["9600","9749"],["975","999"]]},"978-607":{name:"Mexico",ranges:[["00","39"],["400","592"],["59300","59999"],["600","749"],["7500","9499"],["95000","99999"]]},"978-608":{name:"North Macedonia",ranges:[["0","0"],["10","19"],["200","449"],["4500","6499"],["65000","69999"],["7","9"]]},"978-609":{name:"Lithuania",ranges:[["00","39"],["400","799"],["8000","9499"],["95000","99999"]]},"978-611":{name:"Thailand",ranges:[]},"978-612":{name:"Peru",ranges:[["00","29"],["300","399"],["4000","4499"],["45000","49999"],["5000","5149"]]},"978-613":{name:"Mauritius",ranges:[["0","9"]]},"978-614":{name:"Lebanon",ranges:[["00","39"],["400","799"],["8000","9499"],["95000","99999"]]},"978-615":{name:"Hungary",ranges:[["00","09"],["100","499"],["5000","7999"],["80000","89999"]]},"978-616":{name:"Thailand",ranges:[["00","19"],["200","699"],["7000","8999"],["90000","99999"]]},"978-617":{name:"Ukraine",ranges:[["00","49"],["500","699"],["7000","8999"],["90000","99999"]]},"978-618":{name:"Greece",ranges:[["00","19"],["200","499"],["5000","7999"],["80000","99999"]]},"978-619":{name:"Bulgaria",ranges:[["00","14"],["150","699"],["7000","8999"],["90000","99999"]]},"978-620":{name:"Mauritius",ranges:[["0","9"]]},"978-621":{name:"Philippines",ranges:[["00","29"],["400","599"],["8000","8999"],["95000","99999"]]},"978-622":{name:"Iran",ranges:[["00","10"],["200","424"],["5200","8499"],["90000","99999"]]},"978-623":{name:"Indonesia",ranges:[["00","09"],["130","499"],["5250","8799"],["88000","99999"]]},"978-624":{name:"Sri Lanka",ranges:[["00","04"],["200","249"],["5000","6449"],["94500","99999"]]},"978-625":{name:"Turkey",ranges:[["00","00"],["365","442"],["44300","44499"],["445","449"],["6350","7793"],["77940","77949"],["7795","8499"],["99000","99999"]]},"978-626":{name:"Taiwan",ranges:[["00","04"],["300","499"],["7000","7999"],["95000","99999"]]},"978-627":{name:"Pakistan",ranges:[["30","31"],["500","524"],["7500","7999"]]},"978-628":{name:"Colombia",ranges:[["00","09"],["500","549"],["7500","8499"],["95000","99999"]]},"978-629":{name:"Malaysia",ranges:[["00","02"],["470","499"],["7500","7999"],["96500","99999"]]},"978-630":{name:"Romania",ranges:[["300","349"],["6500","6849"]]},"978-631":{name:"Argentina",ranges:[["00","09"],["300","399"],["6500","7499"],["90000","99999"]]},"978-65":{name:"Brazil",ranges:[["00","01"],["250","299"],["300","302"],["5000","5129"],["5350","6149"],["80000","81824"],["84500","89999"],["900000","902449"],["980000","999999"]]},"978-7":{name:"China, People's Republic",ranges:[["00","09"],["100","499"],["5000","7999"],["80000","89999"],["900000","999999"]]},"978-80":{name:"former Czechoslovakia",ranges:[["00","19"],["200","529"],["53000","54999"],["550","689"],["69000","69999"],["7000","8499"],["85000","89999"],["900000","998999"],["99900","99999"]]},"978-81":{name:"India",ranges:[["00","18"],["19000","19999"],["200","699"],["7000","8499"],["85000","89999"],["900000","999999"]]},"978-82":{name:"Norway",ranges:[["00","19"],["200","689"],["690000","699999"],["7000","8999"],["90000","98999"],["990000","999999"]]},"978-83":{name:"Poland",ranges:[["00","19"],["200","599"],["60000","69999"],["7000","8499"],["85000","89999"],["900000","999999"]]},"978-84":{name:"Spain",ranges:[["00","09"],["10000","10499"],["1050","1199"],["120000","129999"],["1300","1399"],["140","149"],["15000","19999"],["200","699"],["7000","8499"],["85000","89999"],["9000","9199"],["920000","923999"],["92400","92999"],["930000","949999"],["95000","96999"],["9700","9999"]]},"978-85":{name:"Brazil",ranges:[["00","19"],["200","454"],["455000","455299"],["45530","45599"],["456","528"],["52900","53199"],["5320","5339"],["534","539"],["54000","54029"],["54030","54039"],["540400","540499"],["54050","54089"],["540900","540999"],["54100","54399"],["5440","5479"],["54800","54999"],["5500","5999"],["60000","69999"],["7000","8499"],["85000","89999"],["900000","924999"],["92500","94499"],["9450","9599"],["96","97"],["98000","99999"]]},"978-86":{name:"former Yugoslavia",ranges:[["00","29"],["300","599"],["6000","7999"],["80000","89999"],["900000","999999"]]},"978-87":{name:"Denmark",ranges:[["00","29"],["400","649"],["7000","7999"],["85000","94999"],["970000","999999"]]},"978-88":{name:"Italy",ranges:[["00","19"],["200","311"],["31200","31499"],["315","318"],["31900","32299"],["323","326"],["3270","3389"],["339","360"],["3610","3629"],["363","548"],["5490","5549"],["555","599"],["6000","8499"],["85000","89999"],["900000","909999"],["910","926"],["9270","9399"],["940000","947999"],["94800","99999"]]},"978-89":{name:"Korea, Republic",ranges:[["00","24"],["250","549"],["5500","8499"],["85000","94999"],["950000","969999"],["97000","98999"],["990","999"]]},"978-90":{name:"Netherlands",ranges:[["00","19"],["200","499"],["5000","6999"],["70000","79999"],["800000","849999"],["8500","8999"],["90","90"],["94","94"]]},"978-91":{name:"Sweden",ranges:[["0","1"],["20","49"],["500","649"],["7000","8199"],["85000","94999"],["970000","999999"]]},"978-92":{name:"International NGO Publishers and EU Organizations",ranges:[["0","5"],["60","79"],["800","899"],["9000","9499"],["95000","98999"],["990000","999999"]]},"978-93":{name:"India",ranges:[["00","09"],["100","499"],["5000","7999"],["80000","95999"],["960000","999999"]]},"978-94":{name:"Netherlands",ranges:[["000","599"],["6000","8999"],["90000","99999"]]},"978-950":{name:"Argentina",ranges:[["00","49"],["500","899"],["9000","9899"],["99000","99999"]]},"978-951":{name:"Finland",ranges:[["0","1"],["20","54"],["550","889"],["8900","9499"],["95000","99999"]]},"978-952":{name:"Finland",ranges:[["00","19"],["200","499"],["5000","5999"],["60","64"],["65000","65999"],["6600","6699"],["67000","69999"],["7000","7999"],["80","94"],["9500","9899"],["99000","99999"]]},"978-953":{name:"Croatia",ranges:[["0","0"],["10","14"],["150","479"],["48000","49999"],["500","500"],["50100","50999"],["51","54"],["55000","59999"],["6000","9499"],["95000","99999"]]},"978-954":{name:"Bulgaria",ranges:[["00","28"],["2900","2999"],["300","799"],["8000","8999"],["90000","92999"],["9300","9999"]]},"978-955":{name:"Sri Lanka",ranges:[["0000","1999"],["20","33"],["3400","3549"],["35500","35999"],["3600","3799"],["38000","38999"],["3900","4099"],["41000","44999"],["4500","4999"],["50000","54999"],["550","710"],["71100","71499"],["7150","9499"],["95000","99999"]]},"978-956":{name:"Chile",ranges:[["00","08"],["09000","09999"],["10","19"],["200","599"],["6000","6999"],["7000","9999"]]},"978-957":{name:"Taiwan",ranges:[["00","02"],["0300","0499"],["05","19"],["2000","2099"],["21","27"],["28000","30999"],["31","43"],["440","819"],["8200","9699"],["97000","99999"]]},"978-958":{name:"Colombia",ranges:[["00","49"],["500","509"],["5100","5199"],["52000","53999"],["5400","5599"],["56000","59999"],["600","799"],["8000","9499"],["95000","99999"]]},"978-959":{name:"Cuba",ranges:[["00","19"],["200","699"],["7000","8499"],["85000","99999"]]},"978-960":{name:"Greece",ranges:[["00","19"],["200","659"],["6600","6899"],["690","699"],["7000","8499"],["85000","92999"],["93","93"],["9400","9799"],["98000","99999"]]},"978-961":{name:"Slovenia",ranges:[["00","19"],["200","599"],["6000","8999"],["90000","97999"]]},"978-962":{name:"Hong Kong, China",ranges:[["00","19"],["200","699"],["7000","8499"],["85000","86999"],["8700","8999"],["900","999"]]},"978-963":{name:"Hungary",ranges:[["00","19"],["200","699"],["7000","8499"],["85000","89999"],["9000","9999"]]},"978-964":{name:"Iran",ranges:[["00","14"],["150","249"],["2500","2999"],["300","549"],["5500","8999"],["90000","96999"],["970","989"],["9900","9999"]]},"978-965":{name:"Israel",ranges:[["00","19"],["200","599"],["7000","7999"],["90000","99999"]]},"978-966":{name:"Ukraine",ranges:[["00","12"],["130","139"],["14","14"],["1500","1699"],["170","199"],["2000","2789"],["279","289"],["2900","2999"],["300","699"],["7000","8999"],["90000","90999"],["910","949"],["95000","97999"],["980","999"]]},"978-967":{name:"Malaysia",ranges:[["0000","0999"],["10000","19999"],["2000","2499"],["250","254"],["25500","26999"],["2700","2799"],["2800","2999"],["300","499"],["5000","5999"],["60","89"],["900","989"],["9900","9989"],["99900","99999"]]},"978-968":{name:"Mexico",ranges:[["01","39"],["400","499"],["5000","7999"],["800","899"],["9000","9999"]]},"978-969":{name:"Pakistan",ranges:[["0","1"],["20","20"],["210","219"],["2200","2299"],["23000","23999"],["24","39"],["400","749"],["7500","9999"]]},"978-970":{name:"Mexico",ranges:[["01","59"],["600","899"],["9000","9099"],["91000","96999"],["9700","9999"]]},"978-971":{name:"Philippines",ranges:[["000","015"],["0160","0199"],["02","02"],["0300","0599"],["06","49"],["500","849"],["8500","9099"],["91000","95999"],["9600","9699"],["97","98"],["9900","9999"]]},"978-972":{name:"Portugal",ranges:[["0","1"],["20","54"],["550","799"],["8000","9499"],["95000","99999"]]},"978-973":{name:"Romania",ranges:[["0","0"],["100","169"],["1700","1999"],["20","54"],["550","759"],["7600","8499"],["85000","88999"],["8900","9499"],["95000","99999"]]},"978-974":{name:"Thailand",ranges:[["00","19"],["200","699"],["7000","8499"],["85000","89999"],["90000","94999"],["9500","9999"]]},"978-975":{name:"Turkey",ranges:[["00000","01999"],["02","23"],["2400","2499"],["250","599"],["6000","9199"],["92000","98999"],["990","999"]]},"978-976":{name:"Caribbean Community",ranges:[["0","3"],["40","59"],["600","799"],["8000","9499"],["95000","99999"]]},"978-977":{name:"Egypt",ranges:[["00","19"],["200","499"],["5000","6999"],["700","849"],["85000","89299"],["893","894"],["8950","8999"],["90","98"],["990","999"]]},"978-978":{name:"Nigeria",ranges:[["000","199"],["2000","2999"],["30000","77999"],["780","799"],["8000","8999"],["900","999"]]},"978-979":{name:"Indonesia",ranges:[["000","099"],["1000","1499"],["15000","19999"],["20","29"],["3000","3999"],["400","799"],["8000","9499"],["95000","99999"]]},"978-980":{name:"Venezuela",ranges:[["00","19"],["200","599"],["6000","9999"]]},"978-981":{name:"Singapore",ranges:[["00","16"],["17000","17999"],["18","19"],["200","299"],["3000","3099"],["310","399"],["4000","9499"],["99","99"]]},"978-982":{name:"South Pacific",ranges:[["00","09"],["100","699"],["70","89"],["9000","9799"],["98000","99999"]]},"978-983":{name:"Malaysia",ranges:[["00","01"],["020","199"],["2000","3999"],["40000","44999"],["45","49"],["50","79"],["800","899"],["9000","9899"],["99000","99999"]]},"978-984":{name:"Bangladesh",ranges:[["00","39"],["400","799"],["8000","8999"],["90000","99999"]]},"978-985":{name:"Belarus",ranges:[["00","39"],["400","599"],["6000","8799"],["880","899"],["90000","99999"]]},"978-986":{name:"Taiwan",ranges:[["00","05"],["06000","06999"],["0700","0799"],["08","11"],["120","539"],["5400","7999"],["80000","99999"]]},"978-987":{name:"Argentina",ranges:[["00","09"],["1000","1999"],["20000","29999"],["30","35"],["3600","4199"],["42","43"],["4400","4499"],["45000","48999"],["4900","4999"],["500","824"],["8250","8279"],["82800","82999"],["8300","8499"],["85","88"],["8900","9499"],["95000","99999"]]},"978-988":{name:"Hong Kong, China",ranges:[["00","11"],["12000","19999"],["200","699"],["70000","79999"],["8000","9699"],["97000","99999"]]},"978-989":{name:"Portugal",ranges:[["0","1"],["20","34"],["35000","36999"],["37","52"],["53000","54999"],["550","799"],["8000","9499"],["95000","99999"]]},"978-9910":{name:"Uzbekistan",ranges:[["730","749"],["9650","9999"]]},"978-9911":{name:"Montenegro",ranges:[["20","24"],["550","749"]]},"978-9912":{name:"Tanzania",ranges:[["40","44"],["750","799"],["9800","9999"]]},"978-9913":{name:"Uganda",ranges:[["00","07"],["600","699"],["9550","9999"]]},"978-9914":{name:"Kenya",ranges:[["40","52"],["700","774"],["9600","9999"]]},"978-9915":{name:"Uruguay",ranges:[["40","59"],["650","799"],["9300","9999"]]},"978-9916":{name:"Estonia",ranges:[["0","0"],["10","39"],["4","5"],["600","799"],["80","84"],["850","899"],["9250","9999"]]},"978-9917":{name:"Bolivia",ranges:[["0","0"],["30","34"],["600","699"],["9800","9999"]]},"978-9918":{name:"Malta",ranges:[["0","0"],["20","29"],["600","799"],["9500","9999"]]},"978-9919":{name:"Mongolia",ranges:[["0","0"],["20","29"],["500","599"],["9000","9999"]]},"978-9920":{name:"Morocco",ranges:[["30","42"],["500","799"],["8750","9999"]]},"978-9921":{name:"Kuwait",ranges:[["0","0"],["30","39"],["700","899"],["9700","9999"]]},"978-9922":{name:"Iraq",ranges:[["20","29"],["600","799"],["8500","9999"]]},"978-9923":{name:"Jordan",ranges:[["0","0"],["10","59"],["700","899"],["9400","9999"]]},"978-9924":{name:"Cambodia",ranges:[["30","39"],["500","649"],["9000","9999"]]},"978-9925":{name:"Cyprus",ranges:[["0","2"],["30","54"],["550","734"],["7350","9999"]]},"978-9926":{name:"Bosnia and Herzegovina",ranges:[["0","1"],["20","39"],["400","799"],["8000","9999"]]},"978-9927":{name:"Qatar",ranges:[["00","09"],["100","399"],["4000","4999"]]},"978-9928":{name:"Albania",ranges:[["00","09"],["100","399"],["4000","4999"],["800","899"],["90","99"]]},"978-9929":{name:"Guatemala",ranges:[["0","3"],["40","54"],["550","799"],["8000","9999"]]},"978-9930":{name:"Costa Rica",ranges:[["00","49"],["500","939"],["9400","9999"]]},"978-9931":{name:"Algeria",ranges:[["00","23"],["240","899"],["9000","9999"]]},"978-9932":{name:"Lao People's Democratic Republic",ranges:[["00","39"],["400","849"],["8500","9999"]]},"978-9933":{name:"Syria",ranges:[["0","0"],["10","39"],["400","899"],["9000","9999"]]},"978-9934":{name:"Latvia",ranges:[["0","0"],["10","49"],["500","799"],["8000","9999"]]},"978-9935":{name:"Iceland",ranges:[["0","0"],["10","39"],["400","899"],["9000","9999"]]},"978-9936":{name:"Afghanistan",ranges:[["0","1"],["20","39"],["400","799"],["8000","9999"]]},"978-9937":{name:"Nepal",ranges:[["0","2"],["30","49"],["500","799"],["8000","9999"]]},"978-9938":{name:"Tunisia",ranges:[["00","79"],["800","949"],["9500","9749"],["975","990"],["9910","9999"]]},"978-9939":{name:"Armenia",ranges:[["0","4"],["50","79"],["800","899"],["9000","9599"],["960","979"],["98","99"]]},"978-9940":{name:"Montenegro",ranges:[["0","1"],["20","49"],["500","839"],["84","86"],["8700","9999"]]},"978-9941":{name:"Georgia",ranges:[["0","0"],["10","39"],["400","799"],["8","8"],["9000","9999"]]},"978-9942":{name:"Ecuador",ranges:[["00","59"],["600","699"],["7000","7499"],["750","849"],["8500","8999"],["900","984"],["9850","9999"]]},"978-9943":{name:"Uzbekistan",ranges:[["00","29"],["300","399"],["4000","9749"],["975","999"]]},"978-9944":{name:"Turkey",ranges:[["0000","0999"],["100","499"],["5000","5999"],["60","69"],["700","799"],["80","89"],["900","999"]]},"978-9945":{name:"Dominican Republic",ranges:[["00","00"],["010","079"],["08","39"],["400","569"],["57","57"],["580","799"],["80","80"],["810","849"],["8500","9999"]]},"978-9946":{name:"Korea, P.D.R.",ranges:[["0","1"],["20","39"],["400","899"],["9000","9999"]]},"978-9947":{name:"Algeria",ranges:[["0","1"],["20","79"],["800","999"]]},"978-9948":{name:"United Arab Emirates",ranges:[["00","39"],["400","849"],["8500","9999"]]},"978-9949":{name:"Estonia",ranges:[["00","08"],["090","099"],["10","39"],["400","699"],["70","71"],["7200","7499"],["75","89"],["9000","9999"]]},"978-9950":{name:"Palestine",ranges:[["00","29"],["300","849"],["8500","9999"]]},"978-9951":{name:"Kosova",ranges:[["00","38"],["390","849"],["8500","9799"],["980","999"]]},"978-9952":{name:"Azerbaijan",ranges:[["0","1"],["20","39"],["400","799"],["8000","9999"]]},"978-9953":{name:"Lebanon",ranges:[["0","0"],["10","39"],["400","599"],["60","89"],["9000","9299"],["93","96"],["970","999"]]},"978-9954":{name:"Morocco",ranges:[["0","1"],["20","39"],["400","799"],["8000","9899"],["99","99"]]},"978-9955":{name:"Lithuania",ranges:[["00","39"],["400","929"],["9300","9999"]]},"978-9956":{name:"Cameroon",ranges:[["0","0"],["10","39"],["400","899"],["9000","9999"]]},"978-9957":{name:"Jordan",ranges:[["00","39"],["400","649"],["65","67"],["680","699"],["70","84"],["8500","8799"],["88","99"]]},"978-9958":{name:"Bosnia and Herzegovina",ranges:[["00","01"],["020","029"],["0300","0399"],["040","089"],["0900","0999"],["10","18"],["1900","1999"],["20","49"],["500","899"],["9000","9999"]]},"978-9959":{name:"Libya",ranges:[["0","1"],["20","79"],["800","949"],["9500","9699"],["970","979"],["98","99"]]},"978-9960":{name:"Saudi Arabia",ranges:[["00","59"],["600","899"],["9000","9999"]]},"978-9961":{name:"Algeria",ranges:[["0","2"],["30","69"],["700","949"],["9500","9999"]]},"978-9962":{name:"Panama",ranges:[["00","54"],["5500","5599"],["56","59"],["600","849"],["8500","9999"]]},"978-9963":{name:"Cyprus",ranges:[["0","1"],["2000","2499"],["250","279"],["2800","2999"],["30","54"],["550","734"],["7350","7499"],["7500","9999"]]},"978-9964":{name:"Ghana",ranges:[["0","6"],["70","94"],["950","999"]]},"978-9965":{name:"Kazakhstan",ranges:[["00","39"],["400","899"],["9000","9999"]]},"978-9966":{name:"Kenya",ranges:[["000","139"],["14","14"],["1500","1999"],["20","69"],["7000","7499"],["750","820"],["8210","8249"],["825","825"],["8260","8289"],["829","959"],["9600","9999"]]},"978-9967":{name:"Kyrgyz Republic",ranges:[["00","39"],["400","899"],["9000","9999"]]},"978-9968":{name:"Costa Rica",ranges:[["00","49"],["500","939"],["9400","9999"]]},"978-9969":{name:"Algeria",ranges:[["00","06"],["500","649"],["9700","9999"]]},"978-9970":{name:"Uganda",ranges:[["00","39"],["400","899"],["9000","9999"]]},"978-9971":{name:"Singapore",ranges:[["0","5"],["60","89"],["900","989"],["9900","9999"]]},"978-9972":{name:"Peru",ranges:[["00","09"],["1","1"],["200","249"],["2500","2999"],["30","59"],["600","899"],["9000","9999"]]},"978-9973":{name:"Tunisia",ranges:[["00","05"],["060","089"],["0900","0999"],["10","69"],["700","969"],["9700","9999"]]},"978-9974":{name:"Uruguay",ranges:[["0","2"],["30","54"],["550","749"],["7500","8799"],["880","909"],["91","94"],["95","99"]]},"978-9975":{name:"Moldova",ranges:[["0","0"],["100","299"],["3000","3999"],["4000","4499"],["45","89"],["900","949"],["9500","9999"]]},"978-9976":{name:"Tanzania",ranges:[["0","4"],["5000","5799"],["580","589"],["59","89"],["900","989"],["9900","9999"]]},"978-9977":{name:"Costa Rica",ranges:[["00","89"],["900","989"],["9900","9999"]]},"978-9978":{name:"Ecuador",ranges:[["00","29"],["300","399"],["40","94"],["950","989"],["9900","9999"]]},"978-9979":{name:"Iceland",ranges:[["0","4"],["50","64"],["650","659"],["66","75"],["760","899"],["9000","9999"]]},"978-9980":{name:"Papua New Guinea",ranges:[["0","3"],["40","89"],["900","989"],["9900","9999"]]},"978-9981":{name:"Morocco",ranges:[["00","09"],["100","159"],["1600","1999"],["20","79"],["800","949"],["9500","9999"]]},"978-9982":{name:"Zambia",ranges:[["00","79"],["800","989"],["9900","9999"]]},"978-9983":{name:"Gambia",ranges:[["80","94"],["950","989"],["9900","9999"]]},"978-9984":{name:"Latvia",ranges:[["00","49"],["500","899"],["9000","9999"]]},"978-9985":{name:"Estonia",ranges:[["0","4"],["50","79"],["800","899"],["9000","9999"]]},"978-9986":{name:"Lithuania",ranges:[["00","39"],["400","899"],["9000","9399"],["940","969"],["97","99"]]},"978-9987":{name:"Tanzania",ranges:[["00","39"],["400","879"],["8800","9999"]]},"978-9988":{name:"Ghana",ranges:[["0","3"],["40","54"],["550","749"],["7500","9999"]]},"978-9989":{name:"North Macedonia",ranges:[["0","0"],["100","199"],["2000","2999"],["30","59"],["600","949"],["9500","9999"]]},"978-99901":{name:"Bahrain",ranges:[["00","49"],["500","799"],["80","99"]]},"978-99902":{name:"Reserved Agency",ranges:[]},"978-99903":{name:"Mauritius",ranges:[["0","1"],["20","89"],["900","999"]]},"978-99904":{name:"Curaçao",ranges:[["0","5"],["60","89"],["900","999"]]},"978-99905":{name:"Bolivia",ranges:[["0","3"],["40","79"],["800","999"]]},"978-99906":{name:"Kuwait",ranges:[["0","2"],["30","59"],["600","699"],["70","89"],["90","94"],["950","999"]]},"978-99908":{name:"Malawi",ranges:[["0","0"],["10","89"],["900","999"]]},"978-99909":{name:"Malta",ranges:[["0","3"],["40","94"],["950","999"]]},"978-99910":{name:"Sierra Leone",ranges:[["0","2"],["30","89"],["900","999"]]},"978-99911":{name:"Lesotho",ranges:[["00","59"],["600","999"]]},"978-99912":{name:"Botswana",ranges:[["0","3"],["400","599"],["60","89"],["900","999"]]},"978-99913":{name:"Andorra",ranges:[["0","2"],["30","35"],["600","604"]]},"978-99914":{name:"International NGO Publishers",ranges:[["0","4"],["50","69"],["7","7"],["80","86"],["870","879"],["88","89"],["900","999"]]},"978-99915":{name:"Maldives",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99916":{name:"Namibia",ranges:[["0","2"],["30","69"],["700","999"]]},"978-99917":{name:"Brunei Darussalam",ranges:[["0","2"],["30","88"],["890","999"]]},"978-99918":{name:"Faroe Islands",ranges:[["0","3"],["40","79"],["800","999"]]},"978-99919":{name:"Benin",ranges:[["0","2"],["300","399"],["40","79"],["800","999"]]},"978-99920":{name:"Andorra",ranges:[["0","4"],["50","89"],["900","999"]]},"978-99921":{name:"Qatar",ranges:[["0","1"],["20","69"],["700","799"],["8","8"],["90","99"]]},"978-99922":{name:"Guatemala",ranges:[["0","3"],["40","69"],["700","999"]]},"978-99923":{name:"El Salvador",ranges:[["0","1"],["20","79"],["800","999"]]},"978-99924":{name:"Nicaragua",ranges:[["0","1"],["20","79"],["800","999"]]},"978-99925":{name:"Paraguay",ranges:[["0","0"],["10","19"],["200","299"],["3","3"],["40","79"],["800","999"]]},"978-99926":{name:"Honduras",ranges:[["0","0"],["10","59"],["600","869"],["87","89"],["90","99"]]},"978-99927":{name:"Albania",ranges:[["0","2"],["30","59"],["600","999"]]},"978-99928":{name:"Georgia",ranges:[["0","0"],["10","79"],["800","999"]]},"978-99929":{name:"Mongolia",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99930":{name:"Armenia",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99931":{name:"Seychelles",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99932":{name:"Malta",ranges:[["0","0"],["10","59"],["600","699"],["7","7"],["80","99"]]},"978-99933":{name:"Nepal",ranges:[["0","2"],["30","59"],["600","999"]]},"978-99934":{name:"Dominican Republic",ranges:[["0","1"],["20","79"],["800","999"]]},"978-99935":{name:"Haiti",ranges:[["0","2"],["30","59"],["600","699"],["7","8"],["90","99"]]},"978-99936":{name:"Bhutan",ranges:[["0","0"],["10","59"],["600","999"]]},"978-99937":{name:"Macau",ranges:[["0","1"],["20","59"],["600","999"]]},"978-99938":{name:"Srpska, Republic of",ranges:[["0","1"],["20","59"],["600","899"],["90","99"]]},"978-99939":{name:"Guatemala",ranges:[["0","2"],["30","59"],["60","89"],["900","999"]]},"978-99940":{name:"Georgia",ranges:[["0","0"],["10","69"],["700","999"]]},"978-99941":{name:"Armenia",ranges:[["0","2"],["30","79"],["800","999"]]},"978-99942":{name:"Sudan",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99943":{name:"Albania",ranges:[["0","2"],["30","59"],["600","999"]]},"978-99944":{name:"Ethiopia",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99945":{name:"Namibia",ranges:[["0","4"],["50","89"],["900","999"]]},"978-99946":{name:"Nepal",ranges:[["0","2"],["30","59"],["600","999"]]},"978-99947":{name:"Tajikistan",ranges:[["0","2"],["30","69"],["700","999"]]},"978-99948":{name:"Eritrea",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99949":{name:"Mauritius",ranges:[["0","1"],["20","79"],["8","8"],["900","989"],["99","99"]]},"978-99950":{name:"Cambodia",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99951":{name:"Reserved Agency",ranges:[]},"978-99952":{name:"Mali",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99953":{name:"Paraguay",ranges:[["0","2"],["30","79"],["800","939"],["94","99"]]},"978-99954":{name:"Bolivia",ranges:[["0","2"],["30","69"],["700","879"],["88","99"]]},"978-99955":{name:"Srpska, Republic of",ranges:[["0","1"],["20","59"],["600","799"],["80","99"]]},"978-99956":{name:"Albania",ranges:[["00","59"],["600","859"],["86","99"]]},"978-99957":{name:"Malta",ranges:[["0","1"],["20","79"],["800","949"],["95","99"]]},"978-99958":{name:"Bahrain",ranges:[["0","4"],["50","93"],["940","949"],["950","999"]]},"978-99959":{name:"Luxembourg",ranges:[["0","2"],["30","59"],["600","999"]]},"978-99960":{name:"Malawi",ranges:[["070","099"],["10","94"],["950","999"]]},"978-99961":{name:"El Salvador",ranges:[["0","2"],["300","369"],["37","89"],["900","999"]]},"978-99962":{name:"Mongolia",ranges:[["0","4"],["50","79"],["800","999"]]},"978-99963":{name:"Cambodia",ranges:[["00","49"],["500","919"],["92","99"]]},"978-99964":{name:"Nicaragua",ranges:[["0","1"],["20","79"],["800","999"]]},"978-99965":{name:"Macau",ranges:[["0","2"],["300","359"],["36","62"],["630","999"]]},"978-99966":{name:"Kuwait",ranges:[["0","2"],["30","69"],["700","799"],["80","96"],["970","999"]]},"978-99967":{name:"Paraguay",ranges:[["0","0"],["10","59"],["600","999"]]},"978-99968":{name:"Botswana",ranges:[["0","3"],["400","599"],["60","89"],["900","999"]]},"978-99969":{name:"Oman",ranges:[["0","4"],["50","79"],["800","949"],["95","99"]]},"978-99970":{name:"Haiti",ranges:[["0","4"],["50","89"],["900","999"]]},"978-99971":{name:"Myanmar",ranges:[["0","3"],["40","84"],["850","999"]]},"978-99972":{name:"Faroe Islands",ranges:[["0","4"],["50","89"],["900","999"]]},"978-99973":{name:"Mongolia",ranges:[["0","3"],["40","79"],["800","999"]]},"978-99974":{name:"Bolivia",ranges:[["0","0"],["10","25"],["260","399"],["40","63"],["640","649"],["65","79"],["800","999"]]},"978-99975":{name:"Tajikistan",ranges:[["0","2"],["300","399"],["40","79"],["800","999"]]},"978-99976":{name:"Srpska, Republic of",ranges:[["0","0"],["10","15"],["160","199"],["20","59"],["600","819"],["82","89"],["900","999"]]},"978-99977":{name:"Rwanda",ranges:[["0","1"],["40","69"],["700","799"],["975","999"]]},"978-99978":{name:"Mongolia",ranges:[["0","4"],["50","69"],["700","999"]]},"978-99979":{name:"Honduras",ranges:[["0","3"],["40","79"],["800","999"]]},"978-99980":{name:"Bhutan",ranges:[["0","0"],["30","59"],["750","999"]]},"978-99981":{name:"Macau",ranges:[["0","1"],["200","219"],["24","74"],["750","999"]]},"978-99982":{name:"Benin",ranges:[["0","1"],["50","68"],["900","999"]]},"978-99983":{name:"El Salvador",ranges:[["0","0"],["50","69"],["950","999"]]},"978-99984":{name:"Brunei Darussalam",ranges:[["0","0"],["50","69"],["950","999"]]},"978-99985":{name:"Tajikistan",ranges:[["0","1"],["35","79"],["850","999"]]},"978-99986":{name:"Myanmar",ranges:[["0","0"],["50","69"],["950","999"]]},"978-99987":{name:"Luxembourg",ranges:[["700","999"]]},"978-99988":{name:"Sudan",ranges:[["0","0"],["50","54"],["800","824"]]},"978-99989":{name:"Paraguay",ranges:[["0","0"],["50","64"],["900","999"]]},"978-99990":{name:"Ethiopia",ranges:[["0","0"],["50","54"],["975","999"]]},"978-99992":{name:"Oman",ranges:[["0","1"],["50","64"],["950","999"]]},"978-99993":{name:"Mauritius",ranges:[["0","0"],["50","54"],["980","999"]]},"979-10":{name:"France",ranges:[["00","19"],["200","699"],["7000","8999"],["90000","97599"],["976000","999999"]]},"979-11":{name:"Korea, Republic",ranges:[["00","24"],["250","549"],["5500","8499"],["85000","94999"],["950000","999999"]]},"979-12":{name:"Italy",ranges:[["200","299"],["5450","5999"],["80000","84999"]]},"979-8":{name:"United States",ranges:[["200","229"],["3500","3999"],["4000","8499"],["8500","8849"],["88500","89999"],["9850000","9899999"]]}})}var Me=e=>{let t=0;if(9===e.length){for(let n=0;n<9;n+=1)t+=(10-n)*e.charAt(n);return t=(11-t%11)%11,10===t?"X":String(t)}if(12===e.length){for(let n=0;n<12;n+=2)t+=Number(e.charAt(n))+3*e.charAt(n+1);return String((10-t%10)%10)}return null};const $e=De(),Le=Me;const We=De(),Fe={};Object.keys(We).forEach((e=>{const[t,n]=e.split("-"),i=n[0];Fe[t]=Fe[t]||{},Fe[t][i]=Fe[t][i]||{},Fe[t][i][n]=We[e]}));const Pe=e=>{const t=e.substring(0,3);if(!Fe[t])return null;const n=e.substring(3),i=n[0],a=Fe[t];if(!a)return null;const s=a[i];for(let e in s)if(n.startsWith(e))return{group:e,ranges:s[e].ranges,restAfterGroup:n.slice(e.length)};return null};const He=e=>{const t=Pe(e);if(!t)return null;const{group:n,ranges:i,restAfterGroup:a}=t;for(let e of i){const[t,i]=e,s=a.substr(0,t.length);if(t<=s&&i>=s){const e=a.substr(s.length);return{group:n,publisher:s,article:e.slice(0,-1),check:e.slice(-1)}}}return null},je=e=>{if(!e)return null;const t=e.prefix||"978",{group:n,publisher:i,article:a}=e,s=$e[`${t}-${n}`];if(!s)return null;e.groupname=s.name;const r=`${n}${i}${a}`,o=e.check10=Le(r);if(!o)return null;const c=e.check13=Le(t+r);return c?(e.isbn13=`${t}${n}${i}${a}${c}`,e.isbn13h=`${t}-${n}-${i}-${a}-${c}`,"978"===t&&(e.isbn10=`${n}${i}${a}${o}`,e.isbn10h=`${n}-${i}-${a}-${o}`),e):null},Ue=e=>(10===e.length&&(e="978"+e),13===e.length?He(e):null);var ze=e=>{if(null==e)return null;const t=e=e.toString();if(!e)return null;e=e.replace(/\s/g,"").replace(/-/g,"");let n=Ue(e);return n?(n.source=t,13===e.length?(n.prefix=e.substring(0,3),n.isIsbn13=!0,n.isIsbn10=!1):(n.isIsbn10=!0,n.isIsbn13=!1),n=je(n),n?(n.isValid=n.check===(n.isIsbn13?n.check13:n.check10),n.isValid?n:null):null):null};const qe=ze,Ge=Me;const Ve=(e,t,n)=>{const i=`${t}${e.substring(3,12)}`,a=Ge(i),s=qe(`${i}${a}`);if(null!=s){const{isbn13h:e,isbn13:t,groupname:i}=s;n.push({message:"possible prefix error",candidate:e,isbn13:t,groupname:i})}},Je=(e,t,n)=>{const i=`${t}${e.substring(3)}`,a=qe(i);if(null!=a){const{isbn13h:e,isbn13:t,groupname:i}=a;n.push({message:"checksum hints different prefix",candidate:e,isbn13:t,groupname:i})}},Ye=e=>e.replace(/[^\dX]/g,""),Ke=ze;var Qe={parse:Ke,audit:e=>{if("string"!=typeof e||0===e.length)throw Error(`invalid input: ${e}`);const t={source:e},n=qe(e);t.validIsbn=null!=n;const i=[],a=Ye(e);return n?(t.groupname=n.groupname,13===a.length&&(a.startsWith("978")?Ve(a,"979",i):a.startsWith("979")&&Ve(a,"978",i))):13===a.length&&(a.startsWith("978")?Je(a,"979",i):a.startsWith("979")&&Je(a,"978",i)),t.clues=i,t},hyphenate:e=>{const t=Ke(e);return t?t.isIsbn13?t.isbn13h:t.isbn10h:null},asIsbn13:(e,t)=>{const n=Ke(e);return n?t?n.isbn13h:n.isbn13:null},asIsbn10:(e,t)=>{const n=Ke(e);return n&&n.isbn10?t?n.isbn10h:n.isbn10:null},groups:De()};function Xe(e){return e.replace(/\s|-/g,"").toUpperCase()}function Ze(e){const t=Qe.parse(e);return t?.isbn10&&t.isbn13?[t.isbn13,t.isbn10]:t?.isbn13?[t.isbn13]:[Xe(e)]}const et="0.7";function tt(e){return`ISBNExportTool/${et} (${e?e+"; ":""}+https://github.com/ChrisJohnsen/ISBN-Export-Tool)`}const nt=N(A([E(),E()])),it=C({version:(at=2,_({test:(e,t)=>e===at||I(t,`Expected ${v(at)} (got ${v(e)})`)})),data:N(A([E(),E(),O()]))});var at;function st(e,t){const n=new Map,i=new Map,a=function(e,t,n){const i=2592e6;let a;if(t)if("restoreArgument"in t)if(t.import)if(nt(t.import))a=new Map(t.import.flatMap((([e,n])=>{try{return[[t.restoreArgument(e),t.restoreResolution(n)]]}catch{return[]}})).map((([e,t])=>[e,{resolution:t,expiration:Date.now()+i}])));else{if(!it(t.import))throw"saved.import does not match any recognized format";a=new Map(t.import.data.flatMap((([e,n,i])=>{try{return[[t.restoreArgument(e),{resolution:t.restoreResolution(n),expiration:i}]]}catch{return[]}})))}else a=new Map;else a=new Map(t.data.map((([e,t,n])=>[e,{resolution:t,expiration:n}])));else a=new Map;const s=e=>n?.getCacheKey?.(e)??e,r=e=>n?.getCachedResolution?.(e)??{hit:!1,value:void 0},o=(e,t,i)=>n?.transformResolution?.(e,t,i,(e=>ct(e,a)))??{resolution:t,expiration:i},c=(e,t)=>n?.cacheResolution?.(e,t);function l(e){{const t=r(e);if(t.hit)return t}{const t=ct(e,a),n=Date.now();if(t.hit&&n<t.value.expiration){const i=o(e,t.value.resolution,t.value.expiration);if(n<i.expiration)return c(e,i),ot(i.resolution)}}return{hit:!1,value:void 0}}const h=Date.now();a.forEach((({resolution:e,expiration:t},n)=>{h<t?c(n,o(n,e,t)):a.delete(n)}));const d=new Map,u="cacheForMillis"in e?t=>e.fn(t).then((t=>new rt(t,{forMillis:e.cacheForMillis}))):e,g=e=>{const t=s(e);{const e=ct(t,d);if(e.hit)return e.value;const n=l(t);if(n.hit)return Promise.resolve(n.value)}const n=u(e).then((({value:e,expiration:n})=>{const i=Date.now()<n,s=o(t,e,n);return i&&a.set(t,{resolution:e,expiration:n}),i&&c(t,s),s.resolution}));return d.set(t,n),n.finally((()=>d.delete(t))).catch((()=>{})),n};function f(e){return e?{version:2,data:Array.from(a.entries()).map((([t,{resolution:n,expiration:i}])=>[e.saveArgument(t),e.saveResolution(n),i]))}:{version:2,data:Array.from(a.entries()).map((([e,{resolution:t,expiration:n}])=>[e,t,n]))}}function p(e){return l(s(e))}return g.saveCache=f,g.checkCache=p,g}(e,t,{getCacheKey:e=>Ze(e)[0],getCachedResolution:e=>{const t=ct(e,i);return t.hit&&Date.now()<t.value.expiration?ot(t.value.resolution):{hit:!1,value:void 0}},transformResolution:(e,t,i,a)=>{(()=>{const t=a(e);return t.hit?c(e,t.value.resolution):[]})().forEach((t=>n.get(t)?.delete(e)));const s=new Set(c(e,t)),r=new Set;s.forEach((t=>{const i=n.get(t);if(i)i.add(e),i.forEach((e=>r.add(e)));else{const i=new Set([e]);n.set(t,i),r.add(e)}})),r.delete(e);const o=Date.now();return Array.from(r).reduce((({resolution:e,expiration:t},n)=>{const i=a(n);return i.hit&&o<i.value.expiration?(c(n,i.value.resolution).forEach((t=>e.add(t))),{resolution:e,expiration:Math.min(t,i.value.expiration)}):{resolution:e,expiration:t}}),{resolution:s,expiration:i});function c(e,t){const n=Array.from(t,(e=>Ze(e)[0]));return n.push(e),n}},cacheResolution:(e,{resolution:t,expiration:n})=>t.forEach((e=>i.set(e,{resolution:t,expiration:n})))});return a}class rt{value;expiration=0;constructor(e,t){this.value=e,"object"==typeof t&&("until"in t?this.expiration=t.until.valueOf():"forMillis"in t&&(this.expiration=Date.now()+t.forMillis))}}function ot(e){return{hit:!0,value:e}}function ct(e,t){return t.has(e)?ot(t.get(e)):{hit:!1,value:void 0}}class lt{throttles=new Map;set(e,t){const n=ht(e),i=t.match(/^\s*(\d+)\s*$/),a=i?new Date(Date.now()+1e3*parseInt(i[1])):new Date(t);return this.throttles.set(n,a.valueOf()),a}shouldThrottle(e){const t=this.throttles.get(ht(e));return void 0!==t&&Date.now()<t&&new Date(t)}}function ht(e){const t=e.match(new RegExp("^https?://([^/]+)"));return t?t[1].toLowerCase():e}class dt{description;constructor(e){this.description=e}}async function ut(e,t,n,i){const[a,s]=t instanceof rt?[t,t.value]:[void 0,t],r=function(e,t){if("string"==typeof t)return t;const n=t.status,i=`${n}${t.statusText?` ${t.statusText}`:""}`;var a;return{temporary:`${e} ${500<=(a=n)&&a<600?"server error:":400<=a&&a<500?"client error:":300<=a&&a<400?"unfinished redirect:":200<=a&&a<300?"OK as error!?:":100<=a&&a<200?"interim as final!?:":"bad(?)"} HTTP status ${i}`}}(e,s);return("string"==typeof r?await i(r):new n(r)).expires(a?.expiration)}class gt{set=new Set;warnings=[];temporaryFaults=[];cacheUntil;constructor(e){e&&("warning"in e&&this.addWarning(e.warning),"temporary"in e&&this.addTemporaryFault(e.temporary))}addString(e){return this.set.add(e),this}addError(e,t){const n=e instanceof dt?e:new dt(e.toString());return t.push(n),this}asEditionsISBNResults(){const{warnings:e,temporaryFaults:t,cacheUntil:n}=this;return{isbns:this.set,warnings:e,temporaryFaults:t,cacheUntil:n}}absorbFaults(e){return this.warnings=this.warnings.concat(e.warnings),this.temporaryFaults=this.temporaryFaults.concat(e.temporaryFaults),this}addWarning(e){return this.addError(e,this.warnings)}addTemporaryFault(e){return this.addError(e,this.temporaryFaults)}expires(e){return void 0===e||(e instanceof Date&&(e=e.valueOf()),void 0===this.cacheUntil?this.cacheUntil=e:this.cacheUntil=Math.min(this.cacheUntil,e)),this}}class ft extends gt{next;setNext(e){this.next=e}absorb(e){return e.set.forEach((e=>this.set.add(e))),this.absorbFaults(e),this.expires(e.cacheUntil),this}}const pt="https://openlibrary.org";function mt(e,t){return void 0===t?n:n(t);async function n(t){const n=await async function(e,t){const n=`/isbn/${t}.json`;return ut(n,await e(`${pt}${n}`),gt,(e=>async function(e,t){let n;try{n=JSON.parse(e)}catch{return new gt({temporary:`${t} response is not parseable as JSON`})}const i=B({works:N(E())}),a=M(n,i,{errors:!0});if(a.errors)return new gt({temporary:`${t} malformed?: ${a.errors.join("; ")}`});const s=a.value;if(s.works.length<1)return new gt({temporary:`${t} response .works is empty`});const r=s.works.reduce(((e,n,i)=>{const a=M(n,B({key:k()}),{errors:!0});if(a.errors)return e.addWarning(`${t}.works[${i}] malformed?: ${a.errors.join("; ")}`);const s=a.value.key,r="/works/";return s.startsWith(r)?e.addString(s.slice(r.length)):e.addWarning(`${t} response .works[${i}].key (${s}) does not start with ${r}`)}),new gt);return r.set.size<1?r.addTemporaryFault(`${t} has no valid workIDs`):r}(e,n)))}(e,t);if(n.set.size<1)return n.asEditionsISBNResults();const i=(await Promise.allSettled(Array.from(n.set).map((async t=>wt(e,function(e){return`${pt}/works/${e}/editions.json`}(t)))))).reduce((function(e,t){return"fulfilled"==t.status?e.absorb(t.value):e.addTemporaryFault(t.reason.toString())}),(new ft).expires(n.cacheUntil));if(i.absorbFaults(n),i.set.size<1){const e=new dt(`no valid ISBNs among all editions.jsons for all ${t} works`);return i.addTemporaryFault(e).asEditionsISBNResults()}return i.asEditionsISBNResults()}}async function wt(e,t){return async function(e,t){const n=t.startsWith(pt)?t.slice(pt.length):t;return ut(n,await e(t),ft,(e=>async function(e,t){let n;try{n=JSON.parse(e)}catch{return new ft({temporary:`${t} response is not parseable as JSON`})}const i=new ft;B({links:B({next:k()})})(n)&&(i.next=n.links.next);const a=B({entries:N(E())}),s=M(n,a,{errors:!0});if(s.errors)return i.addTemporaryFault(`${t} malformed?: ${s.errors.join("; ")}`);return s.value.entries.reduce(((e,n,i)=>{const a=M(n,B({isbn_10:$(N(k())),isbn_13:$(N(k()))}),{errors:!0});if(a.errors)return e.addWarning(`${t} .entries[${i}] malformed?: ${a.errors.join("; ")}`);const s=a.value,r=new ft;return[...s.isbn_10??[],...s.isbn_13??[]].forEach((e=>r.addString(Xe(e)))),r.set.size<1&&r.addWarning(`${t} .entries[${i}] has no ISBNs`),e.absorb(r)}),i)}(e,n)))}(e,t).then((t=>t.next?wt(e,t.next).then((e=>t.absorb(e)),(e=>t.addTemporaryFault(e.toString()))):t),(e=>{throw e}))}const bt="https://openlibrary.org";function yt(e,t){return void 0===t?n:n(t);async function n(t){const n=await async function(e,t){const n=`/search.json?q=${t}&fields=isbn`,i=`${bt}${n}`;return ut(n,await e(i),ft,(e=>async function(e,t){let n;try{n=JSON.parse(e)}catch{return new ft({temporary:`${t} response is not parseable as JSON`})}const i=new ft,a=B({docs:N(E())}),s=M(n,a,{errors:!0});if(s.errors)return i.addTemporaryFault(`${t} malformed?: ${s.errors.join("; ")}`);return s.value.docs.reduce(((e,n,i)=>{const a=M(n,B({isbn:N(E())}),{errors:!0});if(a.errors)return e.addWarning(`${t} .docs[${i}] malformed?: ${a.errors.join("; ")}`);const s=a.value,r=new ft;return s.isbn.forEach(((e,n)=>{k()(e)?r.addString(Xe(e)):r.addWarning(`${t} .docs[${i}].isbn[${n}] is not a string`)})),r.set.size<1&&r.addWarning(`${t} .docs[${i}] has no ISBNs`),e.absorb(r)}),i)}(e,n)))}(e,t);if(n.set.size<1){const e=new dt(`no valid ISBNs in search results for ${t}`);return n.addTemporaryFault(e).asEditionsISBNResults()}return n.asEditionsISBNResults()}}const vt="https://www.librarything.com";function St(e,t){return void 0===t?n:n(t);async function n(t){const n=await async function(e,t){const n=`/api/thingISBN/${t}`,i=`${vt}${n}`;return ut(n,await e(i),ft,(e=>async function(e,t){return Array.from(e.matchAll(/<isbn>([^<]*)<\/isbn>/g)).map((e=>e[1])).reduce(((e,n)=>{const i=Xe(n);return 0==i.length?e.addWarning(`${t} empty <isbn>`):e.addString(i)}),new ft)}(e,n)))}(e,t);if(n.set.size<1){const e=new dt(`no valid ISBNs in search results for ${t}`);return n.addTemporaryFault(e).asEditionsISBNResults()}return n.asEditionsISBNResults()}}const It=C({ETag:$(k()),"Last-Modified":$(k())}),Rt=$(C({content:k(),expires:O()},{extra:It}));async function Tt(e,t,n,i,a=(e=>e)){if(!Et(i))return i;const{status:s,content:r,checkHeaders:o}=await e(t,i);return 200==s?{content:a(r),expires:Date.now()+n,...o}:304==s?i?{...i,expires:Date.now()+n}:void console.error("Got a 304, but had no previous value to make If-None-Match or If-Modified-Since"):(console.error(`HTTP status ${s} for ${t}`),i)}function Et(e){return!e||e.expires<=Date.now()}class kt extends Error{constructor(){super("Throttled function aborted"),this.name="AbortError"}}function Ot({limit:e,interval:t,strict:n}){if(!Number.isFinite(e))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(t))throw new TypeError("Expected `interval` to be a finite number");const i=new Map;let a=0,s=0;const r=[];const o=n?function(){const n=Date.now();if(r.length<e)return r.push(n),0;const i=r.shift()+t;return n>=i?(r.push(n),0):(r.push(i),i-n)}:function(){const n=Date.now();return n-a>t?(s=1,a=n,0):(s<e?s++:(a+=t,s=1),a-n)};return e=>{const t=function(...n){if(!t.isEnabled)return(async()=>e.apply(this,n))();let a;return new Promise(((t,s)=>{a=setTimeout((()=>{t(e.apply(this,n)),i.delete(a)}),o()),i.set(a,s)}))};return t.abort=()=>{for(const e of i.keys())clearTimeout(e),i.get(e)(new kt);i.clear(),r.splice(0,r.length)},t.isEnabled=!0,Object.defineProperty(t,"queueSize",{get:()=>i.size}),t}}class Nt{value;next;constructor(e){this.value=e}}class At{#e;#t;#n;constructor(){this.clear()}enqueue(e){const t=new Nt(e);this.#e?(this.#t.next=t,this.#t=t):(this.#e=t,this.#t=t),this.#n++}dequeue(){const e=this.#e;if(e)return this.#e=this.#e.next,this.#n--,e.value}clear(){this.#e=void 0,this.#t=void 0,this.#n=0}get size(){return this.#n}*[Symbol.iterator](){let e=this.#e;for(;e;)yield e.value,e=e.next}}function xt(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new At;let n=0;const i=async(e,i,a)=>{n++;const s=(async()=>e(...a))();i(s);try{await s}catch{}n--,t.size>0&&t.dequeue()()},a=(a,...s)=>new Promise((r=>{((a,s,r)=>{t.enqueue(i.bind(void 0,a,s,r)),(async()=>{await Promise.resolve(),n<e&&t.size>0&&t.dequeue()()})()})(a,r,s)}));return Object.defineProperties(a,{activeCount:{get:()=>n},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),a}const Ct={format:"Goodreads",groupInfo:Mt((e=>Dt("Shelf",Pt(e).shelves))),rowsInGroup:$t(((e,t)=>"Shelf"==e.kind&&function(e,t){const n=t=>Pt(t).shelves.has(e);return void 0===t?n:n(t)}(e.name,t))),missingAndISBNs:Lt((function(e){return["ISBN13","ISBN"].flatMap((t=>{const n=e[t];return n?[n]:[]})).map((e=>e.replace(/^="(.*)"$/,"$1"))).filter((e=>""!=e))})),mainColumns:new Set(["Book Id","Title","Author","Exclusive Shelf","Bookshelves"])},Bt={format:"Goodreads",groupInfo:Mt((e=>Dt("Collection",function(e){const t=e.Collections?Ht(e.Collections):[];return new Set(t)}(e)).concat(Dt("Tag",function(e){const t=e.Tags?Ht(e.Tags):[];return new Set(t)}(e))))),rowsInGroup:$t(((e,t)=>"Collection"==e.kind&&function(e,t){return!!t.Collections&&Ht(t.Collections).includes(e)}(e.name,t)||"Tag"==e.kind&&function(e,t){return!!t.Tags&&Ht(t.Tags).includes(e)}(e.name,t))),missingAndISBNs:Lt((function(e){const t=new Array;e.ISBN&&t.push(e.ISBN.replace(/^\s*\[(.*)\]\s*$/,"$1"));e.ISBNS&&t.push(...Ht(e.ISBNS));return t.filter((e=>""!=e))})),mainColumns:new Set(["Book Id","Title","Primary Author","Secondary Author","Collections","Tags"])};function _t(e){const t=function(e){const t=new Set;for(const n of e)Object.getOwnPropertyNames(n).forEach((e=>t.add(e)));return t}(e),n=e=>e.every((e=>t.has(e)));if(n(["Book Id","Title","Author","Exclusive Shelf","Bookshelves","ISBN","ISBN13"]))return Ct;if(n(["Book Id","Title","Primary Author","Collections","Tags","ISBN","ISBNs"]))return Bt;throw`unrecognized format with columns: ${Array.from(t).join(", ")}`}function Dt(e,t){return Array.from(t).map((t=>({name:t,kind:e})))}function Mt(e){return t=>{const n=new Map;for(const i of t)e(i).forEach((e=>{const t=(()=>{{const t=n.get(e.kind);if(t)return t}const t=new Map;return n.set(e.kind,t),t})(),i=t.get(e.name)??0;t.set(e.name,i+1)}));return n}}function $t(e){return(t,n,i)=>{const a=new Array;for(const s of t)e({kind:n,name:i},s)&&a.push(s);return a}}function Lt(e){return t=>{const n=new Array,i=new Set;for(const a of t){const t=e(a);0==t.length?n.push(a):t.forEach((e=>i.add(Ze(e)[0])))}return{missingISBN:n,isbns:i}}}async function Wt(e,t){return await async function(e,t,n,i,a,s){const r=Array.from(e),{editionsOfs:o,abortAll:c}=function(e,t,n,i,a,s){const r=xt(e);let o;const c=new Promise(((e,t)=>o=()=>t("Limited call aborted")));c.catch((()=>{}));const l=Ot({limit:1,interval:1e3,strict:!0}),h=Ot({limit:1,interval:1e3,strict:!0}),d=[["Open Library WorkEditions",mt,l],["Open Library Search",yt,l],["LibraryThing ThingISBN",St,h]],u=i?d.filter((([e])=>i.has(e))):d,g={saveArgument:e=>e,saveResolution:Array.from},f={restoreArgument:e=>M(e,k(),{throw:!0}),restoreResolution:e=>new Set(M(e,N(k()),{throw:!0}))},p=u.map((([e,i,o])=>{const l=jt((([t])=>({event:"fetch started",service:e,url:t})),t,(([t],n,i)=>({event:"fetch finished",service:e,url:t,elapsed:i})),s),h=n?o(l):l,d=jt((([t])=>({event:"service query started",service:e,isbn:t})),i(h),(([t],n)=>({event:"service query finished",service:e,isbn:t,isbns:n.isbns,warnings:n.warnings,faults:n.temporaryFaults})),s),u=async e=>{const t=await d(e),n={forMillis:864e5},i={forMillis:2592e6},a="number"==typeof t.cacheUntil?{until:new Date(t.cacheUntil)}:t.temporaryFaults.length>1?n:i;return new rt(t.isbns,a)},p=st(u,{import:a?.[e],...f}),m=e=>r(p,e),w=e=>Promise.race([m(e),c]),b=e=>w(e).catch((t=>{try{s?.({event:"rejection",reason:t})}catch{}return new Set([e])}));return{serviceName:e,checkCache:e=>p.checkCache(e),query:b,saveCache:()=>{a&&(a[e]=p.saveCache(g))}}}));return{editionsOfs:p,abortAll:()=>{r.clearQueue(),o(),l((()=>{})).abort(),h((()=>{})).abort()}}}(10,t,n,i,a,s);try{s?.({event:"abort fn",fn:c})}catch{}const l=e=>e[Math.trunc(Math.random()*e.length)],h=r.map((e=>({isbn:e,editionsOf:l(o)}))),{cachedISBNs:d,uncachedAssignments:u}=h.reduce(((e,t)=>{const{isbn:n,editionsOf:i}=t,a=i.checkCache(n);if(a.hit){try{s?.({event:"service cache hit",service:t.editionsOf.serviceName,isbn:n})}catch{}a.value.forEach((t=>e.cachedISBNs.add(t))),f(i.serviceName,n,e.cachedISBNs)}else e.uncachedAssignments.push(t);return e}),{cachedISBNs:new Set,uncachedAssignments:[]});try{const e=new Map,t=(e,t)=>{{const n=e.get(t);if(n)return n}const n=new Set;return e.set(t,n),n};u.forEach((({isbn:n,editionsOf:{serviceName:i}})=>{t(e,i).add(n)})),s?.({event:"query plan",plan:e})}catch{}const g=await Promise.allSettled(u.map((async({isbn:e,editionsOf:t})=>f(t.serviceName,e,await t.query(e)))));return c(),o.forEach((e=>e.saveCache())),g.reduce(((e,t)=>{if("fulfilled"==t.status)for(const n of t.value)e.add(n);else try{s?.({event:"rejection",reason:t.reason})}catch{}return e}),d);function f(e,t,n){return o.forEach((i=>{if(i.serviceName!=e){const e=i.checkCache(t);e.hit&&e.value.forEach((e=>n.add(e)))}})),n}}(e,t.fetcher,t.throttle??!0,t.services,t.cacheData,t.reporter)}function Ft(e){const t=new Set;for(const n of e)Ze(n).forEach((e=>t.add(e)));return t}function Pt(e){const t=e["Exclusive Shelf"],n=e.Bookshelves?e.Bookshelves.split(/\s*,\s*/):[],i=new Set(n);return t&&i.add(t),{exclusive:t,shelves:i}}function Ht(e){return e.split(",").map((e=>e.trim()))}const jt=(e,t,n,i)=>i?((e,t,n)=>(...i)=>{try{e(i)}catch{}const a=Date.now(),s=t(...i);return(async()=>{try{n(i,await s,Date.now()-a)}catch{}})(),s})((t=>i(e(t))),t,((e,t,a)=>i(n(e,t,a)))):t,Ut=Object.freeze(new Set(["Open Library WorkEditions","Open Library Search","LibraryThing ThingISBN"]));var zt=[{name:"outdent",version:"0.8.0",license:"MIT",licenseText:'The MIT License (MIT)\n\nCopyright (c) 2016 Andrew Bradley\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the "Software"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n'},{name:"typanion",version:"3.14.0",license:"MIT",licenseText:null},{name:"papaparse",version:"5.4.1",license:"MIT",licenseText:'The MIT License (MIT)\n\nCopyright (c) 2015 Matthew Holt\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the "Software"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n'},{name:"isbn3",version:"1.1.40",license:"MIT",licenseText:null},{name:"p-throttle",version:"5.1.0",license:"MIT",licenseText:'MIT License\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n'},{name:"yocto-queue",version:"1.0.0",license:"MIT",licenseText:'MIT License\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n'},{name:"p-limit",version:"4.0.0",license:"MIT",licenseText:'MIT License\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n'}];function qt(e){const t=e.constructor;if(!t)return`< ${typeof e}?!? >`;const n=t.title;return"string"==typeof n?n:`< ${t.name} >`}class Gt{constructor(e,t){this.back=e,this.savable=t}static title="Configuration";hideConfig=!0;justUpdated=!1;async build(e,t,n,i){if(this.justUpdated)return void await e.addTextRow("Update installed. Will restart in 5 seconds.");await e.addBackRow(qt(this.back),(()=>t(this.back))),e.addEmptyRow(),await e.addTextRow("Network Access Permissions"),await e.addForwardRow("Get Other Editions",(()=>t(cn.editionsOf(this.savable).uiState(this))));const a=cn.updates(this.savable);await e.addForwardRow("Updates",(()=>t(a.uiState(this)))),e.addEmptyRow(),await e.addForwardRow("check for updates now",(async()=>{if(await n.requestUpdateCheck(!0))await Vt(a,n)&&(this.justUpdated=!0,t(this));else{const e=new Alert;e.title="No Update Available",e.message="No update for this program is currently available.",e.addCancelAction("Okay"),e.presentAlert()}})),e.addEmptyRow(),await e.addTextRow("Acknowledgeable Warnings"),await e.addForwardRow("Get Other Editions is slow",(()=>t(new rn(this,this.savable)))),e.addEmptyRow(),await e.addTextRow('"Debug" Settings'),await e.addCheckableRow("Text Rows Show Line Break Estimations",e.inspections,(()=>{e.inspections=!e.inspections,t(this)})),await e.addForwardRow("Text Row Line Count",(async()=>{const n=new Alert;n.title="Extra Lines For Text Rows",n.message="The height of text rows in this program is estimated based on the text, the current Dynamic Type font settings, and the available display width. If an estimate comes out too low, the text will be truncated and will end in an ellipsis.\n\nIf this happens, you can use this setting to increase the number of estimated lines.\n\nAdd an extra line for every N estimated lines?",n.addTextField("0",String(this.savable.extraLines??0)).setDecimalPadKeyboard(),n.addAction("No Extra Lines"),n.addAction("Set Extra Lines"),n.addCancelAction("Cancel");const i=await n.present();if(-1!=i){if(0==i)this.savable.extraLines=void 0;else if(1==i){const e=parseFloat(n.textFieldValue(0));isFinite(e)&&0!=e?this.savable.extraLines=e:this.savable.extraLines=void 0}e.extraLineEvery=this.savable.extraLines,t(this)}})),await e.addIndentRow(this.savable.extraLines?`Extra line every ${this.savable.extraLines} estimated lines.`:"Uses estimated line count.",{},!1),await e.addForwardRow("other debug stuff",(async()=>{const a=await i();a.builder.extraLineEvery=e.extraLineEvery,await n.debugUI(a),t(this)}))}}async function Vt(e,t){const n=new Alert;n.title="Install Update?",n.message="An updated version of this program is ready to be installed.\n\nAutomatic checks for updates can be disabled in the configuration settings (gear icon on the title row).\n\nDo you want to install this update now?\nBefore the update can be launched, you will need to exit the current session, and close the JavaScript code view if it is open.",n.addAction("Yes"),n.addCancelAction("Not now"),n.addAction("Never");const i=await n.presentAlert();return-1!=i&&(0==i?await t.requestUpdateInstall():1==i&&(e.set(!1),t.clearPendingUpdate(),!1))}class Jt{constructor(e){this.savable=e}static title="Starting…";hideConfig=!0;justUpdated=!1;async build(e,t,n){const i=()=>t(new Yt(this.savable));if(Date.now()<this.firstRun()+6048e5)return i();if(this.justUpdated)return void await e.addTextRow("Update installed. Will restart in 5 seconds.");await e.addSubtitleHelpRow(qt(this));const a=cn.updates(this.savable),s=n.updateStatus();return"dormant"==s?i():"pending"==s?(await e.addTextRow("An update is ready for installation."),un((async()=>{await Vt(a,n)?(this.justUpdated=!0,t(this)):i()}))):"expired"==s?a.denied()?i():(await e.addTextRow("Checking for update (up to 10 seconds)…"),un((async()=>{await a.askAllowed(!0)&&await Promise.race([n.requestUpdateCheck(),new Promise((e=>Timer.schedule(1e4,!1,(()=>e(!1)))))])&&"pending"==n.updateStatus()?t(this):i()}))):void ce()}firstRun(){return void 0===this.savable.firstRun&&(this.savable.firstRun=Date.now()),this.savable.firstRun}}class Yt{constructor(e,t){this.savable=e,this.previousInput=t}static title="Input Selection";async build(e,t,n){await e.addSubtitleHelpRow(qt(this),'Using a book list app or service is a great way to track books you have read and those you want to read. Unfortunately it is quite easy for your "to be read" list to grow until it is difficult to review while browsing books.\n\nMany book sources (libraries, stores, etc.) will let you maintain lists (or wishlists), but there may be no good way to import your "to be read" list from your book list service.\n\nThis program aims to bridge that gap for services that can import a list of ISBNs. Starting with an export from your book list service, it can:\n\n1. select a portion of your book list entries (e.g. your "to be read" list)\n2. review entries that are missing ISBNs (some eBooks and audio books do not use ISBNs and book list services sometimes use these as the default edition of a book if you do not pick a different one),\n3. extract the ISBNs of your book entries,\n4. optionally add the ISBNs of other editions of your books (using external services),\n5. produce the extracted (and, optionally, expanded) list of ISBNS.\n\nThen you can upload this list of ISBNs to a book source (i.e. library or book store) to find out which books they have available.\n\nThese book list export formats are currently supported:\n- Goodreads export (CSV with a specific set of columns) and its Shelves\n- LibraryThing TSV export and its Collections and Tags\nSuggest your favorite book list format for support in future versions!\n\nWhen you have your data ready, tell us where to find it using the selections on this Input Selection screen.',{"Goodreads Export":{link:"https://www.goodreads.com/review/import",text:'Exporting from Goodreads can be done on the Goodreads website:\n\n\nLogin.\n\nIf on a mobile device, tap/click the "Desktop version" link in the footer of the website.\nTap/click on the "My Books" tab.\nIn the left sidebar, find the "Tools" section and tap/click on "Import and Export" link.\nOR\nTap "open Goodreads Export page" below.\n\nOn the Import/Export page tap/click the "Export Library" button at the top of the page.\n\nA link like "Your export from <date>" will appear when the export is ready.\n\n\nOnce the export is ready, you can download the file (it will be in the Files app in your Downloads folder), or view the data in your web browser and use Select All and Copy to copy it to the clipboard.'},"LibraryThing Export":{link:"https://www.librarything.com/more/import",text:'Exporting from LibraryThing can be done on the LibraryThing website:\n\n\nLogin.\n\nTap/click the "More" top tab (inside three-horizontal-lines ("hamburger" menu) in the mobile view).\nIn the "Useful and Fun" section, tap/click the "Import/Export" link.\nOR\nTap "open LibraryThing Export page" below.\n\nIn the "Export from LibraryThing" section, tap/click the "Export as tab-delimited text" link.\n\nTap/click the "Export all books" button, or fill out a filter and tap/click the "Export filtered" button.\n\nA "Download" button will appear when the export is ready.\n\n\nOnce the export is ready, you can download the file (it will be in the Files app in your Downloads folder), or view the data in your web browser and use Select All and Copy to copy it to the clipboard.'}}),e.addEmptyRow(),await e.addTextRow("Where is your export data?"),e.addEmptyRow();const i=e=>{this.previousInput=e,t(new Qt(this,this.savable,e))};if(this.previousInput){const t=this.previousInput;await e.addForwardRow(ue("already loaded",{titleColor:Color.orange()}),(()=>i(t)))}await e.addForwardRow("On the clipboard",(()=>n.requestInput({type:"clipboard"}).then(i))),await e.addForwardRow("In a saved or downloaded file",(()=>n.requestInput({type:"file"}).then(i))),e.addEmptyRow(),await e.addForwardRow("Source Code and Licenses",(()=>t(new Kt(this))))}}class Kt{constructor(e){this.back=e}static title="Source Code and Licenses";hideConfig=!0;async build(e,t){await e.addBackRow(qt(this.back),(()=>t(this.back))),await async function(e){if(await e.addForwardRow("Source Code on GitHub",(async()=>{const e=new Alert;e.title="Open GitHub URL or Copy to Clipboard?",e.message="Would you like to open the GitHub URL for this program in your default web browser, or copy it to the clipboard?",e.addAction("Open"),e.addAction("Copy"),e.addCancelAction("Cancel");const t=await e.presentAlert(),n="https://github.com/ChrisJohnsen/ISBN-Export-Tool";-1!=t&&(0==t?Safari.open(n):1==t&&Pasteboard.copyString(n))})),zt.length<=0)return;e.addEmptyRow();const t=e.adderForTableRow([{align:"left",widthWeight:7},{align:"center",widthWeight:3},{align:"right",widthWeight:3}]),n=(e,n,i,a)=>t([e,n,{title:i,...a.length>0?{titleColor:Color.blue()}:{}}],{onSelect:a.length>0?async()=>{const t=new Alert;t.title=e+" License",t.message=a,t.addCancelAction("Okay"),await t.presentSheet()}:void 0});t(["Included Dependency","Version","License"]);for(const e of zt)await n(e.name??"",e.version??"",e.license??"",e.licenseText??"");zt.some((e=>(e.licenseText?.length??0)>0))&&(e.addEmptyRow(),await e.addTextRow("Tap any blue license to view full license text."))}(e)}}class Qt{constructor(e,t,n){this.back=e,this.savable=t,this.input=n}static title="Item Selection";async build(e,t,n){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),"Start by selecting which items from the exported data we will examine. The next step will check the selection for items that are missing ISBNs.\n\nCurrently only a whole groups of items (shelves, collections, tags) can be selected. On this screen, choose the group that holds the items you want to examine."),e.addEmptyRow(),await e.addTextRow(`Found ${this.input.items} items in export data.`),await e.addTextRow("Choose the group to examine.");const i=async(e,i)=>{this.savable.group={kind:e,name:i},t(new Zt(this,this.savable,{input:this.input,group:{kind:e,name:i},summary:await n.requestGroup(e,i)}))},a=this.input.groupItems,s=e.adderForTableRow([{widthWeight:30,align:"left"},{widthWeight:55,align:"right"},{widthWeight:15,align:"left"}]),r=(e,t,n,i,a=!1)=>s([e,{title:t,titleColor:a?Color.orange():void 0},n],{onSelect:i,cellSpacing:10});await r("Kind","Group","Items");for(const[e,t]of Object.entries(a))for(const n of Object.getOwnPropertyNames(t))await r(e,n,String(a[e]?.[n]),(()=>i(e,n)),e==this.savable.group?.kind&&n==this.savable.group.name)}}async function Xt(e,t,n){await e.addTextRow("Output Options"),await(n?.());const i=await e.adderForTextWithIconRow(["magnifyingglass","doc.on.clipboard","doc"]);await i("View",0,(()=>t({type:"view"}))),await i("Copy to the clipboard",1,(()=>t({type:"clipboard"}))),await i("Save to a file",2,(()=>t({type:"file"})))}class Zt{constructor(e,t,n){this.back=e,this.savable=t,this.igs=n}static title="Item Summary";async build(e,t,n){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),'The bulk of this program works only with ISBNs, so any item that lacks an ISBN can not be usefully processed beyond pointing out the missing ISBN.\n\nItems missing an ISBN often occur because the default edition is an eBook or audio book version that happens to not use an ISBN. If you did not mean to specifically select that non-ISBN edition you can usually change the listing (e.g. Goodreads\' Book Details) to an ISBN-bearing edition so that (in a future data export) its ISBN can be used by the rest of this program.\n\nEvery item from the provided data that does not have an ISBN is in the "Items Missing an ISBN" list. Likewise, every item that has an ISBN will contribute it to the "Item ISBNs" list.\n\nEach category can be viewed or saved by selecting its view/save option.\n\nYou can use the "Select Editions Services" option to extend the list of ISBNs with those of other editions of the same work. See the help on that screen for more information.'),e.addEmptyRow();const i=this.igs.group,a=this.igs.input.groupItems[i.kind]?.[i.name]??0,s=this.igs.summary;await e.addTextRow(`${a} items in selection (${i.kind} ${i.name}).`),await e.addTextRow(`${s.missingISBNCount} items with no ISBN.`),await e.addForwardRow("View/Save Items Missing an ISBN",(()=>t(new en(this,this.igs)))),await e.addTextRow(`${s.isbnCount} items with an ISBN.`),await e.addForwardRow("View/Save Item ISBNs",(()=>t(new tn(this,this.savable,this.igs)))),e.addEmptyRow(),await e.addTextRow("Want to also include the ISBNs of other editions of the extracted item ISBNs?");const r=cn.editionsOf(this.savable);await e.addForwardRow("Select Editions Services",r.denied()?void 0:async()=>{if(0==await r.askAllowed()){const e=new Alert;return e.title="Network Access Disallowed!",e.message="We will not be able to get other edition ISBNs without your permission to access the Internet.\n\nWe need be able to:\n ① ask whether any of the editions services should be disabled, and\n ② send your selected ISBNs to the editions services to ask them for the ISBNs of other editions.",e.addCancelAction("Okay"),void await e.presentAlert()}t(new nn(this,this.savable,this.igs,await n.requestEditionsServices()))}),r.denied()&&await e.addIndentRow("Network Access must not be disallowed before we can proceed.",{},!1),await r.addRow(this,e,t)}}class en{constructor(e,t){this.back=e,this.igs=t}static title="Items Missing an ISBN";async build(e,t,n){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),"Select an Output Option to view or save the full output."),e.addEmptyRow();const i=this.igs.group,a=this.igs.input.groupItems[i.kind]?.[i.name]??0;await e.addTextRow(`${a} items in selection (${i.kind} ${i.name}).`),await e.addTextRow(`${this.igs.summary.missingISBNCount} items with no ISBN.`),await Xt(e,(e=>n.requestOutputMissing(e).then((()=>t(this.back)))))}}class tn{constructor(e,t,n){this.back=e,this.savable=t,this.igs=n}static title="Item ISBNs";async build(e,t,n){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),'Select an Output Option to view or save the full output.\n\nOnly the ISBN-13 version of each ISBN is provided by default. Select the "Include both" option to also include the ISBN-10 version when possible (not all ISBNs have an old-style ISBN-10 version).'),e.addEmptyRow();const i=this.igs.group,a=this.igs.input.groupItems[i.kind]?.[i.name]??0,s=this.savable.both??!1,r=()=>{this.savable.both=!s,t(this)};await e.addTextRow(`${a} items in selection (${i.kind} ${i.name}).`),await e.addTextRow(`${this.igs.summary.isbnCount} items with an ISBN.`),await Xt(e,(e=>n.requestOutputISBNs(s,e).then((()=>t(this.back)))),(()=>e.addCheckableRow("Include both ISBN-10 and ISBN-13?",s,r)))}}class nn{constructor(e,t,n,i){this.back=e,this.savable=t,this.igs=n,this.availableServices=i}static title="Select Editions Services";async build(e,t,n){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),'Books often have multiple editions, and thus multiple ISBNs. Some book lists only let you add one edition of a book, so the directly extracted data will only include (at most) one ISBN for each book.\n\nIf you are interested in finding any edition of the books in your lists, then it might be handy to be able to gather not just the ISBN of the (sometimes arbitrary) edition in your list, but also the ISBNs of other editions of that book.\n\nThis program knows how to ask multiple different book-data services about the ISBNs of other editions of a book.\n\nTo be nice to these helpful services, we rate-limit our queries to each service (one per second per service), and save the answers so that we will not repeatedly ask a service about the same ISBN (we do ask again if our saved answers are "old" though, otherwise we might never learn about new editions of current publications).\n\nThis means it may take some time to process a large list of ISBNs for which we do not yet have any saved data.\n\nUsing multiple services can speed up processing your list of books since we can ask each service about a portion of your ISBNs and talk to all the selected services at the same time (each with their own one query per second rate limit).\n\nThe query distribution among the services is different each time editions are requested. This avoids getting stuck with empty or incomplete answers. When we have seen answers from multiple services we merge them together to try to give a more complete list of edition ISBNs (no database like this is 100% complete, so these services might return different results).'),e.addEmptyRow();const i=this.savable.services??new Set(this.availableServices),a=e=>{const n=new Set(i);n.has(e)?n.delete(e):n.add(e),this.savable.services=n,t(this)};for(const t of this.availableServices)await e.addCheckableRow(t,i.has(t),(()=>a(t)));if(e.addEmptyRow(),i.size>0){const a=this.igs.summary.isbnCount;await e.addForwardRow("Get Other Editions",(async()=>{const e=new WebView;await e.loadHTML("");if(!await e.evaluateJavaScript("navigator.onLine")){const e=new Alert;return e.title="Device Offline?",e.message='This device appears to be offline.\n\nPlease make sure you have an Internet connection before using "Get Other Editions".',e.addCancelAction("Okay"),void await e.presentAlert()}await async function(e,t){if(e.editionsSlowOkay)return!0;const n=new Alert;n.title="Getting Editions May Take Some Time",n.message=`${an}\n\nThis could be up to ${t} seconds for the selected items.\n\n${sn}`,n.addAction("I will wait; do not tell me again."),n.addAction("I will wait."),n.addCancelAction("That is too long to wait!");const i=await n.presentAlert();if(0==i)return e.editionsSlowOkay=!0,!0;if(1==i)return!0;return!1}(this.savable,a)&&t(new dn(this,this.savable,this.igs,await n.requestEditions(Array.from(i),(e=>this.editionsProgress(t,e)))))}))}else await e.addForwardRow("Get Other Editions",void 0),i.size<=0&&await e.addIndentRow("One or more editions services must be selected before we can proceed.",{},!1)}progressState;editionsProgress(e,t){this.progressState?(this.progressState.progress(t),e(this.progressState)):(this.progressState=new hn(this,this.igs.group,t),e(this.progressState))}}const an="Due to using external services, we limit how quickly we issue queries for other edition ISBNs. It will take approximately one second per queried ISBN to finish.",sn="We save the query results for later re-use, so subsequent runs will be faster (assuming some recurring ISBNs).";class rn{constructor(e,t){this.back=e,this.savable=t}static title='"Get Other Editions" Is Slow';hideConfig=!0;async build(e,t){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),'You can select the "do not warn me" option here to skip the warning.'),e.addEmptyRow(),await e.addTextRow(an),await e.addTextRow(sn),e.addEmptyRow(),await e.addTextRow("Do you want to be warned every time about this?");const n=e=>{this.savable.editionsSlowOkay=e,t(this)},i=this.savable.editionsSlowOkay;await e.addCheckableRow("Yes, warn me every time.",!i,(()=>n(void 0)),!1),await e.addCheckableRow("No, do not warn me.",!!i,(()=>n(!0)),!1)}}class on{constructor(e,t){this.savable=e,this.key=t}get netPermission(){return this.savable[this.key]}set netPermission(e){this.savable[this.key]=e}denied(){return 0==this.netPermission}}class cn{constructor(e,t,n,i){this.actionText=n,this.text=i,this.savable=new on(e,t)}static editionsOf(e){return new cn(e,"editionsNetwork","get ISBNs of other editions","Before we can ask about other editions of books, we need to know if any of the services we normally use have become unavailable.\n\n❗ No personal information will be sent for this purpose, we will only request a list of affected services.\n\n\nThen, to get the ISBNs of other editions, we will send your selected ISBNs to external services (Open Library and/or LibraryThing as per your selection).\n\n❗ Only ISBNs of your selected items will be sent. No other information, personal or otherwise will be sent.")}static updates(e){return new cn(e,"updatesNetwork","check for updates","We can periodically check for updates to this program.\n\n❗ No personal information will be sent for this purpose, we will only request the most recent version of this program.")}savable;denied(){return this.savable.denied()}set(e){this.savable.netPermission=e}uiState(e){return new ln(e,this.savable,this.actionText,this.text)}async addRow(e,t,n){const i=this.savable.netPermission,a=1==i?"granted":0==i?"denied":"will ask";await t.addForwardRow({title:"Network Access: "+a,titleColor:"denied"==a?Color.red():void 0},(()=>n(this.uiState(e))))}async askAllowed(e=!1){const t=this.savable.netPermission;if("boolean"==typeof t)return t;const n=new Alert;n.title="Allow Network Access?";const i=e?"Use the gear icon on the title to control the default permission.":"Use the Network Access item (or the gear icon on the title) to control the default permission.";n.message=this.text+"\n\n"+i+"\n\nDo you want to allow this program to use the Internet to "+this.actionText+"?",n.addAction("Yes, use the Internet"),n.addCancelAction("No, do not use the Internet");const a=await n.presentAlert();return-1!=a&&0==a}}class ln{constructor(e,t,n,i){this.back=e,this.savable=t,this.actionText=n,this.text=i}static title="Network Access";hideConfig=!0;async build(e,t){await e.addBackRow(qt(this.back),(()=>t(this.back))),await e.addSubtitleHelpRow(qt(this),"Some portions of this program need to access the Internet, however it will never access any network without your permission.\n\nBy default, this program will ask for your permission each time it needs to access the Internet.\n\nYou can use this screen to grant permission (allow access without asking), reserve permission (the default: ask each time), or deny permission (deny access without asking).\n\nYou can change these settings at any time."),e.addEmptyRow(),await e.addTextRow(this.text),await e.addTextRow(`Would you like to grant, reserve, or deny permission to access the Internet to ${this.actionText}?`);const n=this.savable.netPermission,i=e=>{this.savable.netPermission=e,t(this)};await e.addCheckableRow("Grant permission: Always allow.",1==n,(()=>i(!0)),!1),await e.addCheckableRow("Reserve permission: Ask each time.",null==n,(()=>i(void 0)),!1),await e.addCheckableRow("Deny permission: Never allow.",0==n,(()=>i(!1)),!1)}}class hn{constructor(e,t,n){this.back=e,this.group=t,this.editionsProgress=n}static title="Other Editions Progress";hideConfig=!0;async build(e,t,n){await e.addBackRow("Cancel Other Editions",(async()=>{const e=new Alert;e.title="Cancel Other Editions?",e.message="Normal operation will take approximately one second per query to finish.",e.addAction("Yes: Stop making queries!"),e.addCancelAction("No: I will wait.");-1!=await e.presentAlert()&&(await n.requestCancelEditions(),t(this.back))})),await e.addSubtitleHelpRow(qt(this)),e.addEmptyRow(),await e.addTextRow(`Retrieving ISBNs of other editions of ISBN-bearing items on ${this.group.kind} ${this.group.name}.`);const{total:i,started:a,done:s,fetched:r}=this.editionsProgress,o=i-a,c=a-s;await e.addTextRow("Queries:"),await e.addIndentRow(`${s} done + ${c} active + ${o} waiting = ${i}`),await e.addTextRow("Fetches:"),await e.addIndentRow(`${r}`)}progress(e){this.editionsProgress=e}}class dn{constructor(e,t,n,i){this.back=e,this.savable=t,this.igs=n,this.editionsSummary={...i,received:Date.now()}}static title="Other Editions Summary";editionsSummary;async build(e,t,n){const{isbns:i,editionsServicesSummary:a,received:s}=this.editionsSummary,r=async()=>{if(!(Date.now()-s<5e3))return!0;const e=new Alert;return e.title="Leaving So Soon?",e.message="Other Editions just finished a few seconds ago.\n\nPlease confirm that you want to abandon these results and go back.",e.addAction("Abandon these results and go back now."),e.addCancelAction("Do not go back yet."),-1!=await e.presentAlert()};await e.addBackRow(qt(this.back),(async()=>await r()&&t(this.back))),await e.addSubtitleHelpRow(qt(this),'The ISBNs of other editions of your selected items have been retrieved. The queries are summarized on this screen.\n\nSelect an Output Option to view or save the full list of ISBNs.\n\nOnly the ISBN-13 version of each ISBN is provided by default. Select the "Include both" option to also include the ISBN-10 version when possible (not all ISBNs have an old-style ISBN-10 version).\n\nThe "back" option at the bottom jumps back to the input selection screen (also available through multiple taps on "back" at the top).'),e.addEmptyRow();const o=this.igs.group,c=this.igs.input.groupItems[o.kind]?.[o.name]??0;await e.addTextRow(`${c} items in selection (${o.kind} ${o.name}).`),await e.addTextRow(`${this.igs.summary.isbnCount} items with an ISBN.`),await e.addTextRow(`${i} total ISBNs after retrieving ISBNs of other editions.`),e.addEmptyRow();const l=Object.entries(a).reduce(((e,[,t])=>e+(t?.cacheHits??0)),0);0!=l&&await e.addTextRow(`Reused ${l} Other Editions query results.`);for(const[t,n]of Object.entries(a))n&&(await e.addTextRow(`${t}`),await e.addIndentRow((0!=n.cacheHits?`${n.cacheHits} reused results, `:"")+`${n.queries} new queries`),0!=n.fetches&&(await e.addIndentRow(`${n.fetches} fetches ${n.fetchRate.toFixed(3)}/s`),await e.addIndentRow(`${n.fetchStats.min}/${n.fetchStats.median}/${n.fetchStats.max} (ms min/median/max)`)));e.addEmptyRow();const h=()=>{this.savable.both=!this.savable.both,t(this)};await Xt(e,(e=>n.requestOutputEditionsISBNs(!!this.savable.both,e)),(()=>e.addCheckableRow("Include both ISBN-10 and ISBN-13?",!!this.savable.both,h))),e.addEmptyRow(),await e.addBackRow("Choose New Input",(async()=>await r()&&t(new Yt(this.savable,this.igs.input))))}}function un(e){Timer.schedule(0,!1,e)}var gn="v0.7-0-g9745f39";const fn=function(e){const t=new lt;return async n=>{const i=t.shouldThrottle(n);if(0!=i)return new rt({status:429,statusText:"server requested throttling until "+i.toUTCString()},{until:i});const a=await e(n);if("string"==typeof a)return a;const{status:s,statusText:r,retryAfter:o}=a;if(429==s||503==s){const e=o?t.set(n,o):t.set(n,"600");return new rt({status:s,statusText:r},{until:e})}return{status:s,statusText:r}}}((async e=>{const t=new Request(e);t.headers={"User-Agent":tt("Scriptable")};const n=await t.loadString(),i="number"==typeof(a=t.response.statusCode)?a:parseInt(a,10);var a;if(200<=i&&i<300)return n;const s=new Map(Object.entries(t.response.headers).map((([e,t])=>[e.toLowerCase(),t]))).get("retry-after");return"string"==typeof s?{status:i,statusText:"",retryAfter:s}:{status:i,statusText:""}}));async function pn(e){{const e=e=>Math.trunc(Math.random()*e);await new Promise((t=>Timer.schedule(1*e(200)+200,!1,t)))}const t=e.match(/[?&]q=([ -\dxX]*)/);if(t){const e=Ze(t[1]);return JSON.stringify({docs:[{isbn:[`${e[0]}-1234`,...e.length>1?[`${e[1]}-5678`]:[]]}]})}const n=e.match(/\/isbn\/(.*)\.json$/);if(n)return JSON.stringify({works:[{key:`/works/OL${Ze(n[1])[0]}W`}]});const i=e.match(/\/works\/OL(.*)W\/editions\.json$/);if(i){const e=Ze(i[1]);return JSON.stringify({entries:[{isbn_13:[`${e[0]}-1234`],...e.length>1?{isbn_10:[`${e[1]}-5678`]}:{}}]})}const a=e.match(/thingISBN\/(.*)$/);if(a){const e=Ze(a[1]);return`<idlist>${[`${e[0]}-1234`,...e.length>1?[`${e[1]}-5678`]:[]].map((e=>`<isbn>${e}</isbn>`)).join("")}</idlist>`}throw`nope: ${e}`}async function mn(e,t){const n=new Request(e),i={};i["User-Agent"]=tt("Scriptable"),t&&(t.ETag?i["If-None-Match"]=t.ETag:t["Last-Modified"]&&(i["If-Modified-Since"]=t["Last-Modified"])),n.headers=i;const a=await n.loadString();var s;return{status:"number"==typeof(s=n.response.statusCode)?s:parseInt(s),content:a,checkHeaders:(e=>{const t=new Map(Object.entries(e).filter((e=>"string"==typeof e[1])).map((([e,t])=>[e.toLowerCase(),t])));return{ETag:t.get("ETag".toLowerCase()),"Last-Modified":t.get("Last-Modified".toLowerCase())}})(n.response.headers)}}globalThis.setTimeout=(e,t,...n)=>{if("string"==typeof e)throw"setTimeout with un-compiled code argument not supported";return Timer.schedule(t,!1,(()=>e(...n)))},globalThis.clearTimeout=e=>e.invalidate();const wn=new a(i(module.filename,"json"));if(await wn.read(),wn.data||(wn.data={}),!e(wn.data))throw"restored data is not an object?";if(wn.data.UITableUIData||(wn.data.UITableUIData={}),!e(wn.data.UITableUIData))throw"restored UI data is not an object?";if(wn.data.webcheckData||(wn.data.webcheckData={}),!e(wn.data.webcheckData))throw"restored UI data is not an object?";const bn=()=>wn.write(),yn=i(module.filename,"log"),vn=i(module.filename,"log",(e=>e+" test")),Sn=i(module.filename,"json",(e=>e+" cache")),In=i(module.filename,"json",(e=>e+" test cache")),Rn=new class{constructor(e,t,n,i){this.logPathnamer=e,this.cachePathnamer=t,this.webcheckData=n,this.saveData=i,this.disabledEditionsServices=new Set(["Open Library WorkEditions"])}disabledEditionsServices;enableEditionsService(e,t=!0){t?this.disabledEditionsServices.delete(e):this.disabledEditionsServices.add(e)}testMode=!1;async debugUI(e){const t=e.builder;t.table.showSeparators=!0,t.title="Debug UI",await e.loop((async e=>{await t.addTextRow(`Version: ${et}`),await t.addTextRow(`Git: ${gn}`),await t.addTextRow("Production Mode"),t.addEmptyRow(),await t.adderForTableRow([{widthWeight:1,align:"left"},{widthWeight:1,align:"right"}])(["Test Mode?",String(this.testMode)],{onSelect:()=>{this.testMode=!this.testMode,e.again()}}),await t.addIndentRow('Test Mode makes the following changes:\n1. The GetISBNs "Editions Of" cache is switched to a test-only location.\n2. The GetISBNs "Editions Of" services will not make actual network requests and instead return fake data.');const n=this.disabledEditionsServices.has("Open Library WorkEditions")?"disabled":"enabled",i=()=>this.enableEditionsService("Open Library WorkEditions",this.disabledEditionsServices.has("Open Library WorkEditions"));await t.adderForTableRow([{widthWeight:1,align:"left"},{widthWeight:1,align:"right"}])(["OL:WE status",n],{onSelect:()=>{i(),e.again()}}),await t.addIndentRow("OL:WE requires 1+N fetches/ISBN (throttled to 1 fetch/second) and probably gives the same results as OL:S (which needs only 1 fetch/ISBN).")})),await e.presentationsClosed}get pendingUpdate(){const e=this.webcheckData.updateContent;if("string"==typeof e)return e;this.webcheckData.updateContent=void 0}set pendingUpdate(e){this.webcheckData.updateContent=e}get updatesData(){const e=this.webcheckData.updatesData;if(Rt(e))return e;this.webcheckData.updatesData=void 0}set updatesData(e){this.webcheckData.updatesData=e}updateStatus(){return Et(this.updatesData)?"expired":this.pendingUpdate?"pending":"dormant"}async requestUpdateCheck(e=!1){const t=this.updatesData;return e&&t&&(t.expires=Date.now()-1e3),this.updatesData=await Tt(mn,"https://raw.githubusercontent.com/ChrisJohnsen/ISBN-Export-Tool/released/Scriptable/ISBN%20Tool.js",2592e6,t,(e=>{const t=e.match(/\bgit: (\S+)/),n=t?.[1];return this.pendingUpdate=n&&n!=gn?e:void 0,n??"<no description found>"})),!!this.pendingUpdate}async requestUpdateInstall(){if(this.pendingUpdate){const e=FileManager.local(),t=e.readString(module.filename),n=t.match(/^(?:\/\/.*(?:\r?\n|\r))*/)?.[0]??"";return e.writeString(module.filename,n+this.pendingUpdate),this.pendingUpdate=void 0,await this.saveData(),Timer.schedule(5e3,!1,(()=>Safari.open(URLScheme.forRunningScript()))),!0}return!1}clearPendingUpdate(){this.pendingUpdate=void 0}allRows=[];format;async requestInput(e){const{rows:t,format:i,input:a}=await async function(){const t=e.type;if("clipboard"==t){const e=Pasteboard.pasteString();if(null!=e){const{rows:n,format:i}=await s(e);return{rows:n,format:i,input:{type:t,...await o(i,n)}}}const n=new Alert;throw n.title="Clipboard Empty",n.message="No string value was available from the clipboard. Please Copy the CSV data to the clipboard before selecting this option.",await n.presentAlert(),"no string available from Pasteboard"}if("file"==t){const e=await DocumentPicker.openFile(),i=await new r(e).readString(),{rows:a,format:c}=await s(i);return{rows:a,format:c,input:{type:t,displayName:n(e),...await o(c,a)}}}ce();throw`unhandled input request type: ${t}`}();return this.allRows=t,this.format=i,a;async function s(e){try{const t=await Ce(e);return{rows:t,format:_t(t)}}catch(e){console.error(e);const t=new Alert;throw t.title="Error Parsing Input",t.message="Are you sure that was a CSV data export?",await t.presentAlert(),e}}async function o(e,t){const n=e.groupInfo(t),i=Object.fromEntries(Array.from(n.entries()).map((([e,t])=>[e,Object.fromEntries(Array.from(t.entries()).sort(((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:e[1]-t[1])))])).sort(((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:0)));return{items:t.length,groupItems:i}}}selected;async requestGroup(e,t){if(!this.format)throw"requested group before format established";const{missingISBN:n,isbns:i}=this.format.missingAndISBNs(this.format.rowsInGroup(this.allRows,e,t));return this.selected={group:{kind:e,name:t},missingRows:n,isbns:i},{missingISBNCount:n.length,isbnCount:i.size}}async requestOutputMissing(e){if(!this.format)throw"requested output before format established";if(!this.selected)throw"requested output before anything selected";const t=`ISBNS missing in ${this.selected.group.kind} ${this.selected.group.name}.csv`,n=(i=this.selected.missingRows.map((a=Array.from(this.format.mainColumns),e=>a.reduce(((t,n)=>(n in e&&(t[n]=e[n]),t)),Object.create(null)))),Array.isArray(i)?xe(i):xe({fields:i.header,data:i.rows}));var i,a;return this.output(e,t,n)}async requestOutputISBNs(e,t){if(!this.selected)throw"requested output before anything selected";const n=`ISBNs on ${this.selected.group.kind} ${this.selected.group.name}.txt`,i=e?Ft(this.selected.isbns):this.selected.isbns,a=Array.from(i).join("\n");return this.output(t,n,a)}async output(e,i,a){const s=e.type;if("view"==s){const e=await async function(e,n){const i=new r(t.joinPath(t.temporaryDirectory(),e));return null!=n&&("string"==typeof n?await i.writeString(n):await i.write(n)),i}(i,a);await QuickLook.present(e.pathname,!0),await e.remove()}else if("clipboard"==s)Pasteboard.copyString(a),o("Copied!","The output has been copied to the clipboard.");else if("file"==s){const e=await DocumentPicker.exportString(a,i);1==e.length?o("Saved to File","The output has been saved to the file:\n\n"+n(e[0])):e.length>1&&o("Saved to Multiple Files?","The output has been saved to the files?:\n\n"+e.map(n).join("\n"))}else ce();function o(e,t){const n=new Alert;n.title=e,n.message=t,n.addCancelAction("Okay"),n.presentAlert()}}async refreshDisabledEditionsServices(){const e=(e=>{if(Rt(e))return e;this.webcheckData.disabledEditionsData=void 0})(this.webcheckData.disabledEditionsData),t=await Tt(mn,"https://raw.githubusercontent.com/ChrisJohnsen/ISBN-Export-Tool/released/disabled-services",6048e5,e);this.webcheckData.disabledEditionsData=t;const n=t?.content;return n?new Set(n.split("\n").map((e=>e.trim())).filter((e=>Ut.has(e)))):new Set}activeServices;async requestEditionsServices(){const e=new Set(Ut);return(await this.refreshDisabledEditionsServices()).forEach((t=>e.delete(t))),this.disabledEditionsServices.forEach((t=>e.delete(t))),this.activeServices=e,Array.from(e)}abortingFetches=!1;editionsPromise;abortEditions;editionsISBNs=new Set;async requestEditions(t,n){if(!this.selected)throw"requested editions before anything selected";if(!this.activeServices)throw"requested editions before services requested";if(this.testMode){const e=this.testMode?{title:"Warning: Test Mode Active",message:'External services for Get ISBNs "Other Editions" will not be contacted, fake data will be returned instead.',continue:"Continue in Test Mode",switch:"Switch to Normal Mode and Continue"}:{title:"Warning: Test Mode Inactive",message:'Actual requests will be made to external services for Get ISBNs of "Other Editions".',continue:"Continue in Normal Mode",switch:"Switch to Test Mode and Continue"},t=new Alert;t.title=e.title,t.message=e.message,t.addAction(e.continue),t.addAction(e.switch),t.addCancelAction("Do Not Run Get ISBNs");const n=await t.presentAlert();if(-1==n)throw"Aborted Get ISBNs after checking test mode";1==n&&(this.testMode=!this.testMode)}if(this.editionsPromise)throw console.error("requested a editions while it is already running"),"editions already running";const i=this.selected.isbns;this.abortingFetches=!1,this.editionsPromise=(async()=>{const r=(e=>t=>this.abortingFetches?Promise.reject(`aborting ${t}`):e(t))(this.testMode?pn:fn),o=new s(this.logPathnamer(this.testMode)),c=new a(this.cachePathnamer(this.testMode)),l={total:0,started:0,done:0,fetched:0},h=new Map,d=e=>{{const t=h.get(e);if(t)return t}const t={hits:0,queries:0,fetches:new Array};return h.set(e,t),t};await c.read();const u=(t=>{if(!t)return;if(e(t.data))return t.data;const n={};return t.data=n,n})(c),g=await Wt(i,{services:new Set(t.filter((e=>Ut.has(e))).filter((e=>this.activeServices?.has(e)))),cacheData:u,fetcher:r,reporter:e=>{if(this.abortingFetches)return;const t=e.event;if("abort fn"==t)this.abortEditions=e.fn;else if("rejection"==t)console.warn("GetISBNS Other Editions reported rejection"),console.error(e.reason);else if("service cache hit"==t)d(e.service).hits++;else if("query plan"==t)l.total=Array.from(e.plan.values()).reduce(((e,t)=>e+t.size),0);else if("service query started"==t){l.started++,n(l);const t=d(e.service);t.firstBegan||(t.firstBegan=Date.now()),t.queries++}else"fetch started"==t?console.log(`started ${e.url}`):"fetch finished"==t?(d(e.service).fetches.push(e.elapsed),l.fetched++,n(l)):"service query finished"==t&&(d(e.service).lastEnded=Date.now(),l.done++,n(l),e.warnings.forEach((e=>{console.warn(e.description),o.append(e.description)})),e.faults.forEach((e=>{console.warn(e.description),o.append(e.description)})))}});await c.write(),await o.flush();const f=e=>{e.sort(((e,t)=>e-t));const t=e.length%2==1?e[(e.length-1)/2]:(e[e.length/2-1]+e[e.length/2])/2;return{min:e[0],max:e[e.length-1],median:t}},p=Object.fromEntries(Array.from(h.entries()).map((([e,t])=>{const n=t.fetches.length/(((t.lastEnded??0)-(t.firstBegan??0))/1e3);return[e,{cacheHits:t.hits,queries:t.queries,fetches:t.fetches.length,fetchRate:n,fetchStats:f(t.fetches)}]})));return this.editionsISBNs=g,{isbns:g.size,editionsServicesSummary:p}})();try{return await this.editionsPromise}finally{this.abortEditions=void 0,this.editionsPromise=void 0}}async requestCancelEditions(){return this.abortIfRunning()}async requestOutputEditionsISBNs(e,t){if(!this.selected)throw"requested output before anything selected";const n=`ISBNs of editions of ISBNs on ${this.selected.group.kind} ${this.selected.group.name}.txt`,i=e?Ft(this.editionsISBNs):this.editionsISBNs,a=Array.from(i).join("\n");return this.output(t,n,a)}async abortIfRunning(){this.abortingFetches=!0,this.abortEditions?.(),await this.editionsPromise}}((e=>e?vn:yn),(e=>e?In:Sn),wn.data.webcheckData,bn),Tn=await ae.start(Re.create);new class{constructor(e,t){this.controller=e,this.savedDataObject=t;const n=this.savedDataObject,i=n.group,a=n.services,s=n.both,r=n.editionsSlowOkay,o=n.editionsNetwork,c=n.updatesNetwork,l=n.firstRun,h=n.extraLines;this.savable.group=i&&"object"==typeof i&&"kind"in i&&"string"==typeof i.kind&&"name"in i&&"string"==typeof i.name?i:void 0,this.savable.services=Array.isArray(a)?new Set(a.filter((e=>"string"==typeof e))):void 0,this.savable.both="boolean"==typeof s?s:void 0,this.savable.editionsSlowOkay=1==r||void 0,this.savable.editionsNetwork="boolean"==typeof o?o:void 0,this.savable.updatesNetwork="boolean"==typeof c?c:void 0,this.savable.firstRun="number"==typeof l?l:void 0,this.savable.extraLines="number"==typeof h?h:void 0}savable={};saveData(){this.savedDataObject.group=this.savable.group,this.savedDataObject.services=this.savable.services&&Array.from(this.savable.services),this.savedDataObject.both=this.savable.both,this.savedDataObject.editionsSlowOkay=this.savable.editionsSlowOkay,this.savedDataObject.editionsNetwork=this.savable.editionsNetwork,this.savedDataObject.updatesNetwork=this.savable.updatesNetwork,this.savedDataObject.firstRun=this.savable.firstRun,this.savedDataObject.extraLines=this.savable.extraLines}state=new Jt(this.savable);async run(e){e.builder.title="ISBN Export Tool",e.builder.table.showSeparators=!0,e.builder.extraLineEvery=this.savable.extraLines;const t=()=>e.startNewTable();await e.loop((async n=>{const i=e=>{un((()=>{this.state=e,n.again()}))},a=(e=>{if(!e.hideConfig)return()=>i(new Gt(e,this.savable))})(this.state);(await e.builder.addTitleConfigRow(a)).isHeader=!0;try{await this.state.build(e.builder,i,this.controller,t)}catch(e){console.error(e)}})),this.saveData()}}(Rn,wn.data.UITableUIData).run(Tn),await Tn.presentationsClosed,await Rn.abortIfRunning(),await bn();
